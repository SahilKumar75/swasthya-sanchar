# Swasthya Sanchar - Hackverse 4.0 Evolution Plan

## Executive Summary

Transforming your blockchain medical records system into a **Healthcare Intelligence Platform** with:
1. **Real-time Patient Journey Tracking** - Uber-like visibility for healthcare
2. **AI Clinical Documentation** - Voice-to-notes for doctors
3. **Wait Time Prediction ML** - Smart queue management
4. **Zero-Net Protocol** - Offline QR codes that work without internet
5. **WhatsApp Integration** - India's primary messaging platform (500M+ users)
6. **Inclusive Design** - Voice-first for illiterate, accessible for disabled, works on any phone

---

## India-First Design Philosophy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DESIGNING FOR BHARAT (Not just India)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  URBAN (40%)              SEMI-URBAN (25%)           RURAL (35%)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Smartphone  â”‚         â”‚ Smartphone  â”‚          â”‚ Feature     â”‚          â”‚
â”‚  â”‚ 4G/5G       â”‚         â”‚ 3G/4G       â”‚          â”‚ Phone/2G    â”‚          â”‚
â”‚  â”‚ English +   â”‚         â”‚ Hindi +     â”‚          â”‚ Local Lang  â”‚          â”‚
â”‚  â”‚ Hindi       â”‚         â”‚ Regional    â”‚          â”‚ Only        â”‚          â”‚
â”‚  â”‚ Literate    â”‚         â”‚ Semi-literateâ”‚         â”‚ Illiterate  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚        â”‚                       â”‚                        â”‚                   â”‚
â”‚        â–¼                       â–¼                        â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Full App +  â”‚         â”‚ WhatsApp +  â”‚          â”‚ WhatsApp +  â”‚          â”‚
â”‚  â”‚ WhatsApp    â”‚         â”‚ Voice UI    â”‚          â”‚ Voice Only  â”‚          â”‚
â”‚  â”‚             â”‚         â”‚             â”‚          â”‚ + SMS       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â”‚  ACCESSIBILITY MATRIX:                                                      â”‚
â”‚  â”œâ”€â”€ Visual Impairment â†’ Screen Reader + Voice UI + High Contrast          â”‚
â”‚  â”œâ”€â”€ Hearing Impairment â†’ Visual Alerts + Vibration + Text-based           â”‚
â”‚  â”œâ”€â”€ Motor Impairment â†’ Voice Commands + Large Touch Targets               â”‚
â”‚  â”œâ”€â”€ Cognitive â†’ Simple Mode + Icons + Voice Guidance                      â”‚
â”‚  â””â”€â”€ Elderly â†’ Large Text + Voice + WhatsApp (familiar interface)          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 1: System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SWASTHYA SANCHAR PLATFORM                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   PATIENT APP    â”‚  â”‚   DOCTOR APP     â”‚  â”‚  HOSPITAL ADMIN  â”‚          â”‚
â”‚  â”‚  - Journey View  â”‚  â”‚  - Voice Notes   â”‚  â”‚  - Queue Mgmt    â”‚          â”‚
â”‚  â”‚  - QR Code       â”‚  â”‚  - Patient List  â”‚  â”‚  - Analytics     â”‚          â”‚
â”‚  â”‚  - Family Share  â”‚  â”‚  - Records       â”‚  â”‚  - Staff Assign  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                     â”‚                     â”‚                     â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                 â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                      NEXT.JS API LAYER                           â”‚       â”‚
â”‚  â”‚  /api/journey/*  /api/voice/*  /api/queue/*  /api/ai/*          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                 â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    SERVICE LAYER                                 â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚       â”‚
â”‚  â”‚  â”‚ Journey     â”‚  â”‚ Voice       â”‚  â”‚ Queue       â”‚              â”‚       â”‚
â”‚  â”‚  â”‚ Service     â”‚  â”‚ AI Service  â”‚  â”‚ ML Service  â”‚              â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                 â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    DATA LAYER                                    â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚       â”‚
â”‚  â”‚  â”‚ Supabase    â”‚  â”‚ Polygon     â”‚  â”‚ Pinata      â”‚              â”‚       â”‚
â”‚  â”‚  â”‚ (Realtime)  â”‚  â”‚ Blockchain  â”‚  â”‚ IPFS        â”‚              â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 1.5: WhatsApp Integration Architecture

### Why WhatsApp for India?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WHATSAPP IN INDIA - THE FACTS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“± 500+ Million users in India (world's largest market)                    â”‚
â”‚  ğŸ‘´ Used by ALL age groups (unlike other apps)                              â”‚
â”‚  ğŸ˜ï¸ Works in rural areas (low bandwidth optimized)                         â”‚
â”‚  ğŸ“– Familiar UI - even illiterate users know how to use voice messages     â”‚
â”‚  ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Family groups already exist - natural for health sharing               â”‚
â”‚  ğŸ”’ End-to-end encrypted - good for health data                            â”‚
â”‚  ğŸ“ Free voice calls - even on 2G                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WhatsApp Bot Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WHATSAPP BOT FLOW                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  WhatsApp Business API  â”‚
                    â”‚  (via Twilio/Gupshup)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Webhook: /api/whatsapp â”‚
                    â”‚   - Receive messages    â”‚
                    â”‚   - Process commands    â”‚
                    â”‚   - Send responses      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                       â”‚
        â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEXT MSG    â”‚       â”‚  VOICE MSG   â”‚       â”‚  QUICK REPLY â”‚
â”‚  Commands:   â”‚       â”‚  Processed   â”‚       â”‚  Buttons:    â”‚
â”‚  "status"    â”‚       â”‚  via Whisper â”‚       â”‚  [Track]     â”‚
â”‚  "qr"        â”‚       â”‚  AI response â”‚       â”‚  [Share]     â”‚
â”‚  "help"      â”‚       â”‚  in voice    â”‚       â”‚  [Emergency] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PATIENT COMMANDS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  "à¤¨à¤®à¤¸à¥à¤¤à¥‡" / "hi"     â†’ Welcome + Menu in detected language                 â”‚
â”‚  "status" / "à¤¸à¥à¤¥à¤¿à¤¤à¤¿" â†’ Current journey position + wait time                â”‚
â”‚  "qr"                â†’ Receive QR code as image (Zero-Net enabled)         â”‚
â”‚  "share mama"        â†’ Share journey link with contact named "mama"        â”‚
â”‚  "records"           â†’ List recent medical records                         â”‚
â”‚  ğŸ¤ Voice message    â†’ AI understands intent, responds in same language    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FAMILY NOTIFICATIONS (Auto-sent):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  "ğŸ¥ à¤°à¤¾à¤¹à¥à¤² à¤…à¤¬ X-Ray à¤µà¤¿à¤­à¤¾à¤— à¤®à¥‡à¤‚ à¤¹à¥ˆà¤‚"                                           â”‚
â”‚  "â±ï¸ à¤…à¤¨à¥à¤®à¤¾à¤¨à¤¿à¤¤ à¤ªà¥à¤°à¤¤à¥€à¤•à¥à¤·à¤¾: 15 à¤®à¤¿à¤¨à¤Ÿ"                                           â”‚
â”‚  "âœ… à¤°à¤¾à¤¹à¥à¤² à¤•à¤¾ à¤ªà¤°à¤¾à¤®à¤°à¥à¤¶ à¤ªà¥‚à¤°à¤¾ à¤¹à¥‹ à¤—à¤¯à¤¾"                                           â”‚
â”‚                                                                             â”‚
â”‚  [Track Live ğŸ“] [Call Hospital ğŸ“]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WhatsApp Message Templates

```typescript
// src/lib/whatsapp/templates.ts

export const WHATSAPP_TEMPLATES = {
  // JOURNEY UPDATES
  journey_started: {
    en: `ğŸ¥ *{patientName}* has started their visit at *{hospitalName}*

ğŸ“ Current: {currentStep}
â±ï¸ Estimated total time: {estimatedTime}

Track live: {trackingLink}`,
    
    hi: `ğŸ¥ *{patientName}* à¤¨à¥‡ *{hospitalName}* à¤®à¥‡à¤‚ à¤…à¤ªà¤¨à¥€ à¤µà¤¿à¤œà¤¼à¤¿à¤Ÿ à¤¶à¥à¤°à¥‚ à¤•à¥€

ğŸ“ à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨: {currentStep}
â±ï¸ à¤…à¤¨à¥à¤®à¤¾à¤¨à¤¿à¤¤ à¤•à¥à¤² à¤¸à¤®à¤¯: {estimatedTime}

à¤²à¤¾à¤‡à¤µ à¤Ÿà¥à¤°à¥ˆà¤• à¤•à¤°à¥‡à¤‚: {trackingLink}`,
    
    mr: `ğŸ¥ *{patientName}* à¤¯à¤¾à¤‚à¤¨à¥€ *{hospitalName}* à¤¯à¥‡à¤¥à¥‡ à¤­à¥‡à¤Ÿ à¤¸à¥à¤°à¥‚ à¤•à¥‡à¤²à¥€

ğŸ“ à¤¸à¤§à¥à¤¯à¤¾: {currentStep}
â±ï¸ à¤…à¤‚à¤¦à¤¾à¤œà¥‡ à¤à¤•à¥‚à¤£ à¤µà¥‡à¤³: {estimatedTime}

à¤²à¤¾à¤‡à¤µà¥à¤¹ à¤Ÿà¥à¤°à¥…à¤• à¤•à¤°à¤¾: {trackingLink}`
  },

  checkpoint_update: {
    en: `ğŸ“ *Update for {patientName}*

Now at: *{checkpointName}*
Status: {status}
Wait time: ~{waitTime} minutes
Position in queue: #{queuePosition}

{progressBar}`,

    hi: `ğŸ“ *{patientName} à¤•à¥‡ à¤²à¤¿à¤ à¤…à¤ªà¤¡à¥‡à¤Ÿ*

à¤…à¤­à¥€: *{checkpointName}* à¤ªà¤°
à¤¸à¥à¤¥à¤¿à¤¤à¤¿: {status}
à¤ªà¥à¤°à¤¤à¥€à¤•à¥à¤·à¤¾ à¤¸à¤®à¤¯: ~{waitTime} à¤®à¤¿à¤¨à¤Ÿ
à¤•à¤¤à¤¾à¤° à¤®à¥‡à¤‚ à¤¸à¥à¤¥à¤¿à¤¤à¤¿: #{queuePosition}

{progressBar}`
  },

  emergency_qr: {
    en: `ğŸ†˜ *Emergency QR Code for {patientName}*

This QR works WITHOUT internet!
Show to any medical staff in emergency.

Blood Group: *{bloodGroup}*
Allergies: {allergies}

âš ï¸ Keep this saved for emergencies`,

    hi: `ğŸ†˜ *{patientName} à¤•à¥‡ à¤²à¤¿à¤ à¤‡à¤®à¤°à¤œà¥‡à¤‚à¤¸à¥€ QR à¤•à¥‹à¤¡*

à¤¯à¤¹ QR à¤¬à¤¿à¤¨à¤¾ à¤‡à¤‚à¤Ÿà¤°à¤¨à¥‡à¤Ÿ à¤•à¥‡ à¤•à¤¾à¤® à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ!
à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤² à¤®à¥‡à¤‚ à¤•à¤¿à¤¸à¥€ à¤­à¥€ à¤®à¥‡à¤¡à¤¿à¤•à¤² à¤¸à¥à¤Ÿà¤¾à¤« à¤•à¥‹ à¤¦à¤¿à¤–à¤¾à¤à¤‚à¥¤

à¤¬à¥à¤²à¤¡ à¤—à¥à¤°à¥à¤ª: *{bloodGroup}*
à¤à¤²à¤°à¥à¤œà¥€: {allergies}

âš ï¸ à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤² à¤•à¥‡ à¤²à¤¿à¤ à¤‡à¤¸à¥‡ à¤¸à¥‡à¤µ à¤°à¤–à¥‡à¤‚`
  },

  voice_response: {
    // For voice message responses
    understood: {
      en: "I understood: {intent}. {response}",
      hi: "à¤®à¥ˆà¤‚à¤¨à¥‡ à¤¸à¤®à¤à¤¾: {intent}à¥¤ {response}"
    }
  }
};

// Progress bar generator for WhatsApp
export function generateProgressBar(progress: number): string {
  const filled = Math.floor(progress / 10);
  const empty = 10 - filled;
  return 'â–“'.repeat(filled) + 'â–‘'.repeat(empty) + ` ${progress}%`;
}
```

### WhatsApp Webhook Handler

```typescript
// src/app/api/whatsapp/webhook/route.ts

import { NextRequest, NextResponse } from "next/server";
import { processWhatsAppMessage } from "@/lib/whatsapp/processor";
import { sendWhatsAppMessage } from "@/lib/whatsapp/sender";
import { transcribeAudio, detectLanguage } from "@/lib/ai/whisper";

export async function POST(req: NextRequest) {
  const body = await req.json();
  
  // Twilio/Gupshup webhook format
  const { From, Body, MediaUrl0, ProfileName } = body;
  const phoneNumber = From.replace('whatsapp:', '');
  
  try {
    // Check if voice message
    if (MediaUrl0 && MediaUrl0.includes('audio')) {
      // Download and transcribe voice message
      const audioBuffer = await fetch(MediaUrl0).then(r => r.arrayBuffer());
      const { text, language } = await transcribeAudio(audioBuffer);
      
      // Process voice command
      const response = await processWhatsAppMessage({
        phone: phoneNumber,
        message: text,
        isVoice: true,
        language
      });
      
      // Reply in voice if they sent voice (accessibility)
      if (response.replyAsVoice) {
        await sendWhatsAppVoice(phoneNumber, response.text, language);
      } else {
        await sendWhatsAppMessage(phoneNumber, response.text);
      }
      
    } else {
      // Text message
      const language = detectLanguage(Body);
      const response = await processWhatsAppMessage({
        phone: phoneNumber,
        message: Body,
        isVoice: false,
        language
      });
      
      await sendWhatsAppMessage(phoneNumber, response.text, response.buttons);
    }
    
    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('WhatsApp webhook error:', error);
    return NextResponse.json({ error: 'Processing failed' }, { status: 500 });
  }
}

// Verify webhook (GET request from WhatsApp)
export async function GET(req: NextRequest) {
  const mode = req.nextUrl.searchParams.get('hub.mode');
  const token = req.nextUrl.searchParams.get('hub.verify_token');
  const challenge = req.nextUrl.searchParams.get('hub.challenge');
  
  if (mode === 'subscribe' && token === process.env.WHATSAPP_VERIFY_TOKEN) {
    return new NextResponse(challenge);
  }
  
  return NextResponse.json({ error: 'Verification failed' }, { status: 403 });
}
```

### WhatsApp Features Summary

| Feature | Urban | Semi-Urban | Rural | Illiterate |
|---------|-------|------------|-------|------------|
| Journey tracking via text | âœ… | âœ… | âœ… | âŒ |
| Journey tracking via voice | âœ… | âœ… | âœ… | âœ… |
| QR code delivery | âœ… | âœ… | âœ… | âœ… |
| Family notifications | âœ… | âœ… | âœ… | âœ… |
| Voice commands (Hindi/Regional) | âœ… | âœ… | âœ… | âœ… |
| Voice responses | âœ… | âœ… | âœ… | âœ… |
| Medical record access | âœ… | âœ… | âš ï¸ | âŒ |

---

## Part 1.6: Accessibility & Inclusive Design

### Voice-First Interface (For Illiterate Users)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VOICE-FIRST DESIGN PRINCIPLES                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  RULE 1: Every action can be done with voice                               â”‚
â”‚  RULE 2: Every screen speaks its content automatically                      â”‚
â”‚  RULE 3: Icons > Text (universal understanding)                            â”‚
â”‚  RULE 4: Color coding (Green=Good, Red=Alert, Blue=Action)                 â”‚
â”‚  RULE 5: Audio feedback for every interaction                              â”‚
â”‚                                                                             â”‚
â”‚  IMPLEMENTATION:                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  User opens app                                                      â”‚   â”‚
â”‚  â”‚       â†“                                                              â”‚   â”‚
â”‚  â”‚  ğŸ”Š "à¤¨à¤®à¤¸à¥à¤¤à¥‡ à¤°à¤¾à¤¹à¥à¤² à¤œà¥€, à¤†à¤ªà¤•à¤¾ à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ"                                  â”‚   â”‚
â”‚  â”‚  ğŸ”Š "à¤†à¤ª à¤…à¤­à¥€ à¤à¤•à¥à¤¸-à¤°à¥‡ à¤µà¤¿à¤­à¤¾à¤— à¤®à¥‡à¤‚ à¤•à¤¤à¤¾à¤° à¤®à¥‡à¤‚ à¤¹à¥ˆà¤‚"                             â”‚   â”‚
â”‚  â”‚  ğŸ”Š "à¤²à¤—à¤­à¤— 12 à¤®à¤¿à¤¨à¤Ÿ à¤•à¤¾ à¤‡à¤‚à¤¤à¤œà¤¼à¤¾à¤° à¤¹à¥ˆ"                                       â”‚   â”‚
â”‚  â”‚  ğŸ”Š "à¤•à¥à¤› à¤”à¤° à¤œà¤¾à¤¨à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¬à¥‹à¤²à¥‡à¤‚ à¤¯à¤¾ à¤¸à¥à¤•à¥à¤°à¥€à¤¨ à¤¦à¤¬à¤¾à¤à¤‚"                        â”‚   â”‚
â”‚  â”‚       â†“                                                              â”‚   â”‚
â”‚  â”‚  User speaks: "à¤®à¥‡à¤°à¥€ à¤¬à¤¾à¤°à¥€ à¤•à¤¬ à¤†à¤à¤—à¥€?"                                    â”‚   â”‚
â”‚  â”‚       â†“                                                              â”‚   â”‚
â”‚  â”‚  ğŸ”Š "à¤†à¤ªà¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ 3 à¤®à¤°à¥€à¤œà¤¼ à¤¹à¥ˆà¤‚, à¤²à¤—à¤­à¤— 12 à¤®à¤¿à¤¨à¤Ÿ à¤®à¥‡à¤‚ à¤†à¤ªà¤•à¥€ à¤¬à¤¾à¤°à¥€ à¤†à¤à¤—à¥€"          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Text-to-Speech Implementation

```typescript
// src/lib/accessibility/tts.ts

import { useEffect, useRef } from 'react';

// Supported Indian languages for TTS
const VOICE_MAP: Record<string, string> = {
  'en': 'en-IN',      // Indian English
  'hi': 'hi-IN',      // Hindi
  'mr': 'mr-IN',      // Marathi
  'ta': 'ta-IN',      // Tamil
  'te': 'te-IN',      // Telugu
  'bn': 'bn-IN',      // Bengali
  'gu': 'gu-IN',      // Gujarati
  'kn': 'kn-IN',      // Kannada
  'ml': 'ml-IN',      // Malayalam
  'pa': 'pa-IN',      // Punjabi
};

export function useAutoSpeak(text: string, language: string = 'hi') {
  const hasSpoken = useRef(false);

  useEffect(() => {
    if (hasSpoken.current) return;
    if (!text) return;

    const speak = () => {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = VOICE_MAP[language] || 'hi-IN';
      utterance.rate = 0.9;  // Slightly slower for clarity
      utterance.pitch = 1;
      
      // Find best voice for language
      const voices = speechSynthesis.getVoices();
      const indianVoice = voices.find(v => v.lang === VOICE_MAP[language]);
      if (indianVoice) {
        utterance.voice = indianVoice;
      }
      
      speechSynthesis.speak(utterance);
      hasSpoken.current = true;
    };

    // Wait for voices to load
    if (speechSynthesis.getVoices().length > 0) {
      speak();
    } else {
      speechSynthesis.addEventListener('voiceschanged', speak, { once: true });
    }
  }, [text, language]);
}

// Hook to speak on component mount
export function useSpeakOnMount(getText: () => string, language: string = 'hi') {
  useEffect(() => {
    const text = getText();
    if (text) {
      speakText(text, language);
    }
  }, []);
}

export function speakText(text: string, language: string = 'hi') {
  // Stop any current speech
  speechSynthesis.cancel();
  
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = VOICE_MAP[language] || 'hi-IN';
  utterance.rate = 0.9;
  
  speechSynthesis.speak(utterance);
}

// Voice command listener
export function useVoiceCommands(onCommand: (text: string, lang: string) => void) {
  useEffect(() => {
    if (!('webkitSpeechRecognition' in window)) {
      console.warn('Speech recognition not supported');
      return;
    }

    const SpeechRecognition = window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.lang = 'hi-IN';  // Default Hindi, auto-detects others
    
    recognition.onresult = (event) => {
      const result = event.results[event.results.length - 1];
      if (result.isFinal) {
        const text = result[0].transcript;
        const detectedLang = detectLanguageFromText(text);
        onCommand(text, detectedLang);
      }
    };
    
    recognition.start();
    
    return () => recognition.stop();
  }, [onCommand]);
}
```

### Accessible Journey Tracker Component

```typescript
// src/components/journey/AccessibleJourneyTracker.tsx

"use client";

import { useAutoSpeak, speakText } from "@/lib/accessibility/tts";
import { useLanguage } from "@/contexts/LanguageContext";
import { motion } from "framer-motion";

interface AccessibleJourneyTrackerProps {
  journey: Journey;
  checkpoints: Checkpoint[];
}

export function AccessibleJourneyTracker({ journey, checkpoints }: AccessibleJourneyTrackerProps) {
  const { language, t } = useLanguage();
  
  // Find current checkpoint
  const currentCheckpoint = checkpoints.find(c => c.status === 'IN_PROGRESS' || c.status === 'IN_QUEUE');
  
  // Auto-speak status on load
  const statusMessage = currentCheckpoint 
    ? t('journey.currentStatus', {
        location: currentCheckpoint.name,
        waitTime: currentCheckpoint.estimatedWait,
        position: currentCheckpoint.queuePosition
      })
    : t('journey.noActiveJourney');
  
  useAutoSpeak(statusMessage, language);

  return (
    <div 
      className="min-h-screen bg-white dark:bg-neutral-900 p-4"
      role="main"
      aria-label={t('journey.title')}
    >
      {/* Large Visual Status Card */}
      <motion.div
        className="bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl p-8 text-white shadow-xl"
        initial={{ scale: 0.95 }}
        animate={{ scale: 1 }}
        // Make entire card tappable for voice readout
        onClick={() => speakText(statusMessage, language)}
        role="button"
        aria-label={t('accessibility.tapToHear')}
      >
        {/* Giant Icon */}
        <div className="flex justify-center mb-6">
          <div className="w-32 h-32 bg-white/20 rounded-full flex items-center justify-center">
            {currentCheckpoint?.type === 'QUEUE' ? (
              <span className="text-6xl">ğŸ¥</span>
            ) : currentCheckpoint?.type === 'IN_PROGRESS' ? (
              <span className="text-6xl">ğŸ‘¨â€âš•ï¸</span>
            ) : (
              <span className="text-6xl">âœ…</span>
            )}
          </div>
        </div>

        {/* Current Location - Large Text */}
        <h1 className="text-3xl font-bold text-center mb-2">
          {currentCheckpoint?.name || t('journey.completed')}
        </h1>

        {/* Wait Time - Very Large */}
        {currentCheckpoint?.estimatedWait && (
          <div className="text-center">
            <span className="text-7xl font-bold">
              {currentCheckpoint.estimatedWait}
            </span>
            <span className="text-2xl ml-2">{t('common.minutes')}</span>
          </div>
        )}

        {/* Queue Position */}
        {currentCheckpoint?.queuePosition && (
          <p className="text-center text-xl mt-4 opacity-90">
            {t('journey.queuePosition', { position: currentCheckpoint.queuePosition })}
          </p>
        )}

        {/* Audio Indicator */}
        <div className="flex justify-center mt-6">
          <button
            onClick={() => speakText(statusMessage, language)}
            className="flex items-center gap-2 px-6 py-3 bg-white/20 rounded-full"
            aria-label={t('accessibility.readAloud')}
          >
            <span className="text-2xl">ğŸ”Š</span>
            <span>{t('accessibility.tapToHear')}</span>
          </button>
        </div>
      </motion.div>

      {/* Simple Progress Steps - Icon Based */}
      <div className="mt-8">
        <h2 className="sr-only">{t('journey.steps')}</h2>
        <div className="flex justify-between items-center">
          {checkpoints.map((checkpoint, index) => (
            <div 
              key={checkpoint.id}
              className="flex flex-col items-center"
              onClick={() => speakText(
                t('journey.stepStatus', { 
                  step: checkpoint.name, 
                  status: checkpoint.status 
                }), 
                language
              )}
            >
              {/* Step Circle */}
              <div className={`
                w-16 h-16 rounded-full flex items-center justify-center text-2xl
                ${checkpoint.status === 'COMPLETED' 
                  ? 'bg-green-500 text-white' 
                  : checkpoint.status === 'IN_PROGRESS' || checkpoint.status === 'IN_QUEUE'
                  ? 'bg-blue-500 text-white animate-pulse'
                  : 'bg-gray-200 dark:bg-gray-700'
                }
              `}>
                {checkpoint.status === 'COMPLETED' ? 'âœ“' : 
                 checkpoint.status === 'IN_PROGRESS' ? 'ğŸ‘¨â€âš•ï¸' :
                 checkpoint.status === 'IN_QUEUE' ? checkpoint.queuePosition :
                 index + 1}
              </div>
              
              {/* Connector Line */}
              {index < checkpoints.length - 1 && (
                <div className={`
                  h-1 w-12 mt-2
                  ${checkpoint.status === 'COMPLETED' ? 'bg-green-500' : 'bg-gray-200'}
                `} />
              )}
            </div>
          ))}
        </div>
      </div>

      {/* Voice Command Prompt */}
      <div className="fixed bottom-0 left-0 right-0 p-4 bg-white dark:bg-neutral-800 border-t">
        <button
          onClick={() => {/* Activate voice listener */}}
          className="w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-2xl text-xl font-semibold flex items-center justify-center gap-3"
        >
          <span className="text-3xl">ğŸ¤</span>
          {t('accessibility.speakToAsk')}
        </button>
        <p className="text-center text-sm text-gray-500 mt-2">
          {t('accessibility.voiceExample')}
        </p>
      </div>
    </div>
  );
}
```

### Simple Mode (Cognitive Accessibility)

```typescript
// src/components/SimpleMode.tsx

"use client";

import { useState, createContext, useContext } from "react";

interface SimpleModeContextType {
  isSimpleMode: boolean;
  toggleSimpleMode: () => void;
}

const SimpleModeContext = createContext<SimpleModeContextType>({
  isSimpleMode: false,
  toggleSimpleMode: () => {}
});

export function SimpleModeProvider({ children }: { children: React.ReactNode }) {
  const [isSimpleMode, setIsSimpleMode] = useState(() => {
    if (typeof window !== 'undefined') {
      return localStorage.getItem('simpleMode') === 'true';
    }
    return false;
  });

  const toggleSimpleMode = () => {
    setIsSimpleMode(prev => {
      const newValue = !prev;
      localStorage.setItem('simpleMode', String(newValue));
      return newValue;
    });
  };

  return (
    <SimpleModeContext.Provider value={{ isSimpleMode, toggleSimpleMode }}>
      <div className={isSimpleMode ? 'simple-mode' : ''}>
        {children}
      </div>
    </SimpleModeContext.Provider>
  );
}

export const useSimpleMode = () => useContext(SimpleModeContext);

// Simple Mode CSS (add to globals.css)
/*
.simple-mode {
  --font-size-base: 1.25rem;
  --font-size-lg: 1.5rem;
  --font-size-xl: 2rem;
  --spacing-base: 1.5rem;
  --border-radius: 1rem;
}

.simple-mode button {
  min-height: 60px;
  font-size: var(--font-size-lg);
}

.simple-mode .hide-in-simple {
  display: none !important;
}

.simple-mode .show-in-simple {
  display: block !important;
}
*/
```

### Accessibility Features Checklist

```
âœ… VISUAL IMPAIRMENT
â”œâ”€â”€ Screen reader compatible (ARIA labels)
â”œâ”€â”€ High contrast mode toggle
â”œâ”€â”€ Text scaling (up to 200%)
â”œâ”€â”€ Voice descriptions of all UI elements
â”œâ”€â”€ Audio feedback for interactions
â””â”€â”€ No color-only information

âœ… HEARING IMPAIRMENT
â”œâ”€â”€ Visual notifications (screen flash)
â”œâ”€â”€ Vibration patterns for alerts
â”œâ”€â”€ Text alternatives for all audio
â”œâ”€â”€ Sign language video option (future)
â””â”€â”€ Captions for voice notes

âœ… MOTOR IMPAIRMENT
â”œâ”€â”€ Large touch targets (min 48x48px)
â”œâ”€â”€ Voice commands for all actions
â”œâ”€â”€ No time-limited interactions
â”œâ”€â”€ No drag-and-drop required
â””â”€â”€ Single-tap alternatives

âœ… COGNITIVE ACCESSIBILITY
â”œâ”€â”€ Simple mode with fewer options
â”œâ”€â”€ Icon-based navigation
â”œâ”€â”€ Consistent layout
â”œâ”€â”€ Clear progress indicators
â”œâ”€â”€ Voice guidance option
â”œâ”€â”€ No sudden changes
â””â”€â”€ Undo capability

âœ… LOW LITERACY
â”œâ”€â”€ Voice-first interface
â”œâ”€â”€ Icon-based UI
â”œâ”€â”€ Color coding
â”œâ”€â”€ Pictographic instructions
â”œâ”€â”€ Audio playback of all text
â””â”€â”€ WhatsApp voice messages
```

### SMS Fallback (For Feature Phones)

```typescript
// src/lib/notifications/sms.ts

import twilio from 'twilio';

const client = twilio(
  process.env.TWILIO_ACCOUNT_SID,
  process.env.TWILIO_AUTH_TOKEN
);

// SMS templates (very short due to 160 char limit)
const SMS_TEMPLATES = {
  journey_update: {
    en: `{hospital}: {patient} at {location}. Wait ~{wait}min. Q#{pos}. Track: {link}`,
    hi: `{hospital}: {patient} {location} à¤ªà¤°à¥¤ ~{wait}à¤®à¤¿. à¤‡à¤‚à¤¤à¤œà¤¼à¤¾à¤°à¥¤ Q#{pos}à¥¤ à¤Ÿà¥à¤°à¥ˆà¤•: {link}`
  },
  emergency: {
    en: `EMERGENCY: {patient} admitted at {hospital}. Contact: {phone}`,
    hi: `à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²: {patient} {hospital} à¤®à¥‡à¤‚à¥¤ à¤¸à¤‚à¤ªà¤°à¥à¤•: {phone}`
  },
  reminder: {
    en: `Reminder: {patient} appt tomorrow at {hospital}, {time}. Reply CONFIRM`,
    hi: `à¤¯à¤¾à¤¦: {patient} à¤•à¥€ à¤…à¤ªà¥‰à¤‡à¤‚à¤Ÿà¤®à¥‡à¤‚à¤Ÿ à¤•à¤² {hospital}, {time}à¥¤ CONFIRM à¤­à¥‡à¤œà¥‡à¤‚`
  }
};

export async function sendSMS(
  to: string, 
  templateKey: keyof typeof SMS_TEMPLATES,
  language: 'en' | 'hi',
  variables: Record<string, string>
) {
  const template = SMS_TEMPLATES[templateKey][language];
  const message = template.replace(/{(\w+)}/g, (_, key) => variables[key] || '');
  
  // Truncate to SMS limit
  const truncated = message.length > 160 
    ? message.substring(0, 157) + '...' 
    : message;
  
  await client.messages.create({
    body: truncated,
    to: to.startsWith('+91') ? to : `+91${to}`,
    from: process.env.TWILIO_PHONE_NUMBER
  });
}

// USSD Gateway (for feature phones without SMS credit)
// This would require telecom partnership
export async function triggerUSSDCallback(phone: string, sessionData: object) {
  // USSD implementation would go here
  // Typically requires partnership with telecom providers
  console.log('USSD not implemented - requires telecom partnership');
}
```

---

## Part 2: User Roles & Permissions

### 2.1 Role Definitions

| Role | Description | Key Permissions |
|------|-------------|-----------------|
| **Patient** | End user seeking care | View own journey, share with family, control data access |
| **Family Member** | Patient's designated contacts | View patient journey (read-only), receive notifications |
| **Doctor** | Licensed medical practitioner | Voice documentation, view authorized records, update journey status |
| **Nurse/Staff** | Hospital support staff | Update journey checkpoints, manage queues |
| **Hospital Admin** | Facility administrator | Configure departments, view analytics, manage staff |
| **Emergency Responder** | Paramedics/First responders | Scan QR for instant access (no login required) |

### 2.2 Role Hierarchy

```
Hospital Admin
     â”‚
     â”œâ”€â”€ Doctor
     â”‚     â””â”€â”€ Can authorize Nurse to act on their behalf
     â”‚
     â”œâ”€â”€ Nurse/Staff
     â”‚
     â””â”€â”€ Analytics Dashboard Access

Patient (Independent)
     â””â”€â”€ Family Member (Delegated access)

Emergency Responder (Anonymous, QR-gated)
```

---

## Part 3: Database Schema Evolution

### 3.1 New Prisma Models (Add to `prisma/schema.prisma`)

```prisma
// ============================================
// JOURNEY TRACKING MODELS
// ============================================

model Hospital {
  id          String   @id @default(cuid())
  name        String
  code        String   @unique  // e.g., "AIIMS-DEL"
  address     String
  city        String
  state       String
  pincode     String
  phone       String?
  
  // Operational
  isActive    Boolean  @default(true)
  
  // Relations
  departments Department[]
  journeys    PatientJourney[]
  staff       HospitalStaff[]
  queueStats  QueueStatistics[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([code])
  @@index([city])
}

model Department {
  id           String   @id @default(cuid())
  hospitalId   String
  hospital     Hospital @relation(fields: [hospitalId], references: [id])
  
  name         String   // e.g., "Radiology", "OPD", "Emergency"
  code         String   // e.g., "RAD", "OPD", "ER"
  floor        String?
  wing         String?
  
  // Queue configuration
  avgServiceTime  Int   @default(15)  // minutes
  maxCapacity     Int   @default(50)
  
  // Relations
  checkpoints  JourneyCheckpoint[]
  queueStats   QueueStatistics[]
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@unique([hospitalId, code])
  @@index([hospitalId])
}

model PatientJourney {
  id            String   @id @default(cuid())
  
  // Patient reference
  patientId     String
  patient       User     @relation("PatientJourneys", fields: [patientId], references: [id])
  
  // Hospital reference
  hospitalId    String
  hospital      Hospital @relation(fields: [hospitalId], references: [id])
  
  // Journey metadata
  visitType     String   // "OPD", "EMERGENCY", "ADMISSION", "FOLLOW_UP"
  chiefComplaint String?
  priority      Int      @default(3)  // 1=Critical, 2=Urgent, 3=Normal, 4=Low
  
  // Status
  status        String   @default("ACTIVE")  // ACTIVE, COMPLETED, CANCELLED
  startedAt     DateTime @default(now())
  completedAt   DateTime?
  
  // Current position
  currentCheckpointId String?
  estimatedCompletion DateTime?
  
  // Relations
  checkpoints   JourneyCheckpoint[]
  sharedWith    JourneyShare[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([patientId])
  @@index([hospitalId])
  @@index([status])
}

model JourneyCheckpoint {
  id            String   @id @default(cuid())
  
  journeyId     String
  journey       PatientJourney @relation(fields: [journeyId], references: [id], onDelete: Cascade)
  
  departmentId  String
  department    Department @relation(fields: [departmentId], references: [id])
  
  // Checkpoint details
  name          String   // "Registration", "X-Ray", "Dr. Gupta Consultation"
  type          String   // "QUEUE", "IN_PROGRESS", "WAITING_RESULTS", "COMPLETED"
  sequence      Int      // Order in journey
  
  // Timing
  status        String   @default("PENDING")  // PENDING, IN_QUEUE, IN_PROGRESS, COMPLETED, SKIPPED
  queuePosition Int?
  estimatedWait Int?     // minutes
  
  enteredAt     DateTime?
  startedAt     DateTime?
  completedAt   DateTime?
  
  // Staff assignment
  assignedToId  String?
  assignedTo    User?    @relation("AssignedCheckpoints", fields: [assignedToId], references: [id])
  
  // Notes
  notes         String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([journeyId])
  @@index([departmentId])
  @@index([status])
}

model JourneyShare {
  id            String   @id @default(cuid())
  
  journeyId     String
  journey       PatientJourney @relation(fields: [journeyId], references: [id], onDelete: Cascade)
  
  // Share method
  shareType     String   // "LINK", "FAMILY_MEMBER", "QR"
  shareCode     String   @unique  // For link-based sharing
  
  // If shared with registered family member
  sharedWithId  String?
  sharedWith    User?    @relation("SharedJourneys", fields: [sharedWithId], references: [id])
  
  // Permissions
  canViewDetails Boolean @default(true)
  canViewMedical Boolean @default(false)  // See medical details
  
  // Validity
  expiresAt     DateTime?
  isActive      Boolean  @default(true)
  
  createdAt     DateTime @default(now())
  
  @@index([shareCode])
  @@index([journeyId])
}

// ============================================
// AI DOCUMENTATION MODELS
// ============================================

model ClinicalNote {
  id            String   @id @default(cuid())
  
  // References
  doctorId      String
  doctor        User     @relation("DoctorNotes", fields: [doctorId], references: [id])
  
  patientId     String
  patient       User     @relation("PatientNotes", fields: [patientId], references: [id])
  
  // Associated checkpoint (optional)
  checkpointId  String?
  
  // Audio reference
  audioHash     String?  // IPFS hash of audio
  audioDuration Int?     // seconds
  
  // Transcription
  rawTranscript    String?  @db.Text
  processedAt      DateTime?
  
  // AI-generated content
  soapNote         Json?    // { subjective, objective, assessment, plan }
  icdCodes         String[] // Suggested ICD-10 codes
  cptCodes         String[] // Suggested CPT codes
  prescriptions    Json?    // AI-extracted prescriptions
  followUpSuggested DateTime?
  
  // Verification
  isVerified       Boolean  @default(false)
  verifiedAt       DateTime?
  doctorEdits      Json?    // Track what doctor changed
  
  // Blockchain
  recordHash       String?  // Hash stored on blockchain
  transactionHash  String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@index([doctorId])
  @@index([patientId])
}

model VoiceSession {
  id            String   @id @default(cuid())
  
  doctorId      String
  patientId     String
  
  // Session state
  status        String   @default("RECORDING")  // RECORDING, PROCESSING, COMPLETED, FAILED
  
  // Audio chunks (for streaming)
  chunks        VoiceChunk[]
  
  // Final outputs
  clinicalNoteId String?
  
  startedAt     DateTime @default(now())
  endedAt       DateTime?
  
  @@index([doctorId])
  @@index([status])
}

model VoiceChunk {
  id            String   @id @default(cuid())
  
  sessionId     String
  session       VoiceSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  sequence      Int
  audioData     String   @db.Text  // Base64 encoded chunk
  duration      Int      // milliseconds
  
  // Intermediate transcription
  transcript    String?  @db.Text
  
  createdAt     DateTime @default(now())
  
  @@index([sessionId])
}

// ============================================
// QUEUE & PREDICTION MODELS
// ============================================

model QueueStatistics {
  id            String   @id @default(cuid())
  
  hospitalId    String
  hospital      Hospital @relation(fields: [hospitalId], references: [id])
  
  departmentId  String
  department    Department @relation(fields: [departmentId], references: [id])
  
  // Time bucket
  date          DateTime @db.Date
  hour          Int      // 0-23
  dayOfWeek     Int      // 0=Sunday, 6=Saturday
  
  // Statistics
  patientsServed    Int   @default(0)
  avgWaitTime       Int   @default(0)  // minutes
  avgServiceTime    Int   @default(0)  // minutes
  peakQueueLength   Int   @default(0)
  
  // For ML training
  staffCount        Int?
  weatherCondition  String?  // Optional: "clear", "rain", etc.
  isHoliday         Boolean @default(false)
  
  createdAt         DateTime @default(now())
  
  @@unique([hospitalId, departmentId, date, hour])
  @@index([hospitalId, departmentId])
  @@index([date])
}

model WaitTimePrediction {
  id            String   @id @default(cuid())
  
  departmentId  String
  
  // Prediction context
  predictedAt   DateTime @default(now())
  forTimestamp  DateTime  // When this prediction is for
  
  // Prediction values
  predictedWait     Int   // minutes
  confidenceLow     Int   // 90% CI low
  confidenceHigh    Int   // 90% CI high
  
  // Model metadata
  modelVersion  String
  features      Json     // Input features used
  
  // Accuracy tracking (filled in after actual wait is known)
  actualWait    Int?
  
  @@index([departmentId])
  @@index([forTimestamp])
}

// ============================================
// HOSPITAL STAFF MANAGEMENT
// ============================================

model HospitalStaff {
  id            String   @id @default(cuid())
  
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  
  hospitalId    String
  hospital      Hospital @relation(fields: [hospitalId], references: [id])
  
  role          String   // "DOCTOR", "NURSE", "ADMIN", "RECEPTIONIST"
  departmentIds String[] // Departments they can work in
  
  // Schedule
  isOnDuty      Boolean  @default(false)
  currentDepartmentId String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([userId, hospitalId])
  @@index([hospitalId])
  @@index([isOnDuty])
}

// ============================================
// ZERO-NET QR STORAGE
// ============================================

model EmergencyQRData {
  id            String   @id @default(cuid())
  
  patientId     String   @unique
  patient       User     @relation(fields: [patientId], references: [id])
  
  // Compressed emergency data for QR
  compressedData String  @db.Text  // Base64 + compressed JSON
  dataVersion    Int     @default(1)
  
  // What's encoded
  encodedFields  String[]  // ["bloodGroup", "allergies", "medications", "emergencyContact"]
  
  // QR metadata
  qrGenerated    DateTime?
  qrImageHash    String?   // IPFS hash of QR image
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  @@index([patientId])
}

// ============================================
// UPDATE EXISTING USER MODEL
// ============================================

// Add these relations to existing User model:
// patientJourneys    PatientJourney[] @relation("PatientJourneys")
// assignedCheckpoints JourneyCheckpoint[] @relation("AssignedCheckpoints")
// sharedJourneys     JourneyShare[] @relation("SharedJourneys")
// doctorNotes        ClinicalNote[] @relation("DoctorNotes")
// patientNotes       ClinicalNote[] @relation("PatientNotes")
// hospitalStaff      HospitalStaff[]
// emergencyQRData    EmergencyQRData?
```

### 3.2 Database Migration Strategy

```bash
# Step 1: Create migration
npx prisma migrate dev --name add_journey_tracking

# Step 2: Generate client
npx prisma generate

# Step 3: Seed initial hospitals/departments (create seed file)
npx prisma db seed
```

---

## Part 4: User Flows

### 4.1 Patient Journey Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PATIENT JOURNEY FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ENTRY POINTS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Walk-in    â”‚     â”‚  Scheduled  â”‚     â”‚  Emergency  â”‚
â”‚  OPD Visit  â”‚     â”‚  Appointmentâ”‚     â”‚  Arrival    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  REGISTRATION       â”‚
                â”‚  â€¢ Scan patient QR  â”‚
                â”‚  â€¢ Auto-fill from   â”‚
                â”‚    blockchain       â”‚
                â”‚  â€¢ Create journey   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  TRIAGE/VITALS      â”‚
                â”‚  â€¢ Priority assign  â”‚
                â”‚  â€¢ Checkpoint #1    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DIAGNOSTIC  â”‚  â”‚  DIRECT TO   â”‚  â”‚  SPECIALIST  â”‚
â”‚  â€¢ X-Ray     â”‚  â”‚  CONSULTATIONâ”‚  â”‚  REFERRAL    â”‚
â”‚  â€¢ Lab Tests â”‚  â”‚              â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  DOCTOR CONSULTATIONâ”‚
              â”‚  â€¢ Voice recording  â”‚
              â”‚  â€¢ AI generates     â”‚
              â”‚    clinical notes   â”‚
              â”‚  â€¢ Prescription     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              â”‚              â”‚
          â–¼              â–¼              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  PHARMACY  â”‚ â”‚  FOLLOW-UP â”‚ â”‚  ADMISSION â”‚
   â”‚  PICKUP    â”‚ â”‚  SCHEDULED â”‚ â”‚  PROCESS   â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          â”‚              â”‚              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  JOURNEY COMPLETE   â”‚
              â”‚  â€¢ Summary on app   â”‚
              â”‚  â€¢ Records on       â”‚
              â”‚    blockchain       â”‚
              â”‚  â€¢ Feedback prompt  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REAL-TIME VISIBILITY (Throughout):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“± PATIENT VIEW                    ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ FAMILY VIEW            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Current: X-Ray Room     â”‚       â”‚ Mom is at: X-Ray Room   â”‚ â”‚
â”‚  â”‚ Queue Position: 3       â”‚       â”‚ Wait: ~12 mins          â”‚ â”‚
â”‚  â”‚ Est. Wait: 12 mins      â”‚       â”‚ Next: Dr. Gupta         â”‚ â”‚
â”‚  â”‚ â”â”â”â”â”â”â”â”â–‘â–‘â–‘â–‘ 45%       â”‚       â”‚ â”â”â”â”â”â”â”â”â–‘â–‘â–‘â–‘ 45%       â”‚ â”‚
â”‚  â”‚ Next: Dr. Gupta Consult â”‚       â”‚ [Call] [Navigate]       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Doctor Voice Documentation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOCTOR VOICE DOCUMENTATION FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Doctor opens    â”‚
â”‚  patient record  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Start Voice     â”‚     â”‚  EXISTING DATA AUTO-LOADED:             â”‚
â”‚  Session ğŸ™ï¸      â”‚     â”‚  â€¢ Previous visits (blockchain)         â”‚
â”‚                  â”‚â”€â”€â”€â”€â–¶â”‚  â€¢ Current medications                  â”‚
â”‚  [Start Recordingâ”‚     â”‚  â€¢ Allergies, conditions                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â€¢ Last vitals                          â”‚
         â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LIVE RECORDING                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ”´ Recording... 3:42                                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Live Transcript:                                          â”‚ â”‚
â”‚  â”‚  "Patient reports persistent headache for 3 days,          â”‚ â”‚
â”‚  â”‚   worse in the morning. No fever. Taking paracetamol       â”‚ â”‚
â”‚  â”‚   with minimal relief..."                                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [Pause] [Stop & Process]                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI PROCESSING (10-15 seconds)                                   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Whisper API        â”‚  â”‚  Fine-tuned Llama 3             â”‚   â”‚
â”‚  â”‚  Speech â†’ Text      â”‚â”€â–¶â”‚  Text â†’ SOAP Note               â”‚   â”‚
â”‚  â”‚                     â”‚  â”‚  + ICD-10 codes                 â”‚   â”‚
â”‚  â”‚                     â”‚  â”‚  + Prescriptions                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GENERATED CLINICAL NOTE (Editable)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SOAP NOTE                                                 â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚ â”‚
â”‚  â”‚  Subjective:                                               â”‚ â”‚
â”‚  â”‚  Patient presents with 3-day history of persistent         â”‚ â”‚
â”‚  â”‚  headache, worse in morning. Denies fever. Current         â”‚ â”‚
â”‚  â”‚  medication: Paracetamol 500mg PRN with minimal relief.    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Objective:                                                â”‚ â”‚
â”‚  â”‚  BP: 130/85 mmHg, Temp: 98.4Â°F                            â”‚ â”‚
â”‚  â”‚  Neurological exam: unremarkable                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Assessment:                                               â”‚ â”‚
â”‚  â”‚  1. Tension-type headache (ICD-10: G44.2)                 â”‚ â”‚
â”‚  â”‚  2. Rule out: Migraine, Sinusitis                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Plan:                                                     â”‚ â”‚
â”‚  â”‚  1. Ibuprofen 400mg TID x 5 days                          â”‚ â”‚
â”‚  â”‚  2. Stress management counseling                          â”‚ â”‚
â”‚  â”‚  3. Follow-up in 1 week if no improvement                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [Edit] [Regenerate] [Add to Record]                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Suggested Prescriptions:     Suggested Follow-up:               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ â˜‘ Ibuprofen 400mg    â”‚    â”‚ ğŸ“… 1 week            â”‚           â”‚
â”‚  â”‚   TID x 5 days       â”‚    â”‚ Condition: Headache  â”‚           â”‚
â”‚  â”‚ â˜ Add medication     â”‚    â”‚ [Schedule]           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Doctor reviews  â”‚â”€â”€â”€â”€â–¶â”‚  Sign & Submit   â”‚â”€â”€â”€â”€â–¶â”‚  Store on        â”‚
â”‚  & edits         â”‚     â”‚                  â”‚     â”‚  Blockchain +    â”‚
â”‚                  â”‚     â”‚                  â”‚     â”‚  IPFS            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Emergency Zero-Net QR Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ZERO-NET QR PROTOCOL FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CURRENT SYSTEM (URL-based, requires internet):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QR Code    â”‚â”€â”€â”€â”€â–¶â”‚  URL Link   â”‚â”€â”€â”€â”€â–¶â”‚  Fetch from â”‚
â”‚  Scanned    â”‚     â”‚  Opens      â”‚ âŒ  â”‚  Server     â”‚
â”‚             â”‚     â”‚             â”‚ NO  â”‚  (Fails)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ NET â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NEW ZERO-NET SYSTEM (Data embedded in QR):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QR Code    â”‚â”€â”€â”€â”€â–¶â”‚  Data       â”‚â”€â”€â”€â”€â–¶â”‚  Display    â”‚
â”‚  Scanned    â”‚     â”‚  Decoded    â”‚ âœ…  â”‚  Instantly  â”‚
â”‚             â”‚     â”‚  Locally    â”‚ OK! â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

QR DATA STRUCTURE (Compressed JSON):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VERSION 1 - Emergency Profile (~400 bytes, fits in QR)                     â”‚
â”‚                                                                             â”‚
â”‚  {                                                                          â”‚
â”‚    "v": 1,                           // Protocol version                    â”‚
â”‚    "n": "Rahul Sharma",              // Name (truncated to 30 chars)        â”‚
â”‚    "d": "1985-03-15",                // DOB                                 â”‚
â”‚    "b": "B+",                        // Blood group                         â”‚
â”‚    "a": ["Penicillin", "Sulfa"],     // Allergies (max 5)                   â”‚
â”‚    "m": ["Metformin 500mg"],         // Current meds (max 5)                â”‚
â”‚    "c": ["Diabetes T2", "HTN"],      // Conditions (max 5)                  â”‚
â”‚    "e": {                            // Emergency contact                   â”‚
â”‚      "n": "Priya Sharma",                                                   â”‚
â”‚      "r": "Spouse",                                                         â”‚
â”‚      "p": "+91-9876543210"                                                  â”‚
â”‚    },                                                                       â”‚
â”‚    "w": "0x1234...5678",             // Wallet (for full record lookup)     â”‚
â”‚    "t": 1708012800,                  // Timestamp (Unix)                    â”‚
â”‚    "s": "abc123..."                  // Signature (verify authenticity)     â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â”‚  Compression: JSON â†’ MessagePack â†’ Base64                                   â”‚
â”‚  Final size: ~350-450 bytes (fits in standard QR)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FALLBACK STRATEGY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   1. Scan QR â†’ Decode embedded data â†’ Display IMMEDIATELY        â”‚
â”‚                                                                  â”‚
â”‚   2. Background: Check network connectivity                      â”‚
â”‚      â”‚                                                           â”‚
â”‚      â”œâ”€ Online? â†’ Fetch full profile from server                â”‚
â”‚      â”‚            Show "Enhanced data loaded" badge              â”‚
â”‚      â”‚                                                           â”‚
â”‚      â””â”€ Offline? â†’ Show "Offline Mode" badge                     â”‚
â”‚                    Data is from: [timestamp]                     â”‚
â”‚                    "Connect to internet for full records"        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 5: API Design

### 5.1 Journey APIs

```typescript
// ============================================
// JOURNEY MANAGEMENT APIs
// ============================================

// POST /api/journey/create
// Creates a new patient journey
{
  patientId: string,
  hospitalId: string,
  visitType: "OPD" | "EMERGENCY" | "ADMISSION" | "FOLLOW_UP",
  chiefComplaint?: string,
  priority?: 1 | 2 | 3 | 4
}
// Returns: { journeyId, shareCode, checkpoints[] }

// GET /api/journey/[journeyId]
// Get journey details with checkpoints

// POST /api/journey/[journeyId]/checkpoint
// Add or update a checkpoint
{
  departmentId: string,
  name: string,
  type: "QUEUE" | "IN_PROGRESS" | "WAITING_RESULTS" | "COMPLETED",
  sequence: number
}

// PATCH /api/journey/[journeyId]/checkpoint/[checkpointId]
// Update checkpoint status
{
  status: "IN_QUEUE" | "IN_PROGRESS" | "COMPLETED" | "SKIPPED",
  queuePosition?: number,
  notes?: string
}

// POST /api/journey/[journeyId]/share
// Share journey with family/link
{
  shareType: "LINK" | "FAMILY_MEMBER",
  sharedWithEmail?: string,  // If family member
  expiresIn?: number,        // Hours
  canViewMedical?: boolean
}
// Returns: { shareCode, shareUrl }

// GET /api/journey/shared/[shareCode]
// View shared journey (no auth required for LINK type)

// GET /api/journey/patient/active
// Get patient's active journeys

// GET /api/journey/family
// Get journeys shared with current user
```

### 5.2 Voice Documentation APIs

```typescript
// ============================================
// VOICE DOCUMENTATION APIs
// ============================================

// POST /api/voice/session/start
// Start a new voice recording session
{
  patientId: string,
  checkpointId?: string  // Optional: link to journey
}
// Returns: { sessionId }

// POST /api/voice/session/[sessionId]/chunk
// Upload audio chunk (for streaming)
{
  audioData: string,     // Base64 encoded
  sequence: number,
  duration: number       // milliseconds
}

// POST /api/voice/session/[sessionId]/complete
// Finish recording and process
// Returns: { clinicalNoteId, status: "PROCESSING" }

// GET /api/voice/session/[sessionId]/status
// Check processing status
// Returns: { status, progress?, clinicalNoteId? }

// GET /api/voice/note/[noteId]
// Get generated clinical note

// PATCH /api/voice/note/[noteId]
// Update/verify clinical note
{
  soapNote?: object,
  icdCodes?: string[],
  prescriptions?: object,
  isVerified?: boolean
}

// POST /api/voice/note/[noteId]/submit
// Submit to blockchain
// Returns: { recordHash, transactionHash }
```

### 5.3 Queue Prediction APIs

```typescript
// ============================================
// QUEUE & PREDICTION APIs
// ============================================

// GET /api/queue/[departmentId]/current
// Get current queue status
// Returns: { 
//   currentLength: number,
//   estimatedWait: number,
//   avgServiceTime: number,
//   predictions: { time, wait }[]
// }

// GET /api/queue/[departmentId]/predict
// Get wait time prediction
{
  targetTime?: string  // ISO timestamp, default: now
}
// Returns: {
//   predictedWait: number,
//   confidence: { low: number, high: number },
//   factors: string[]
// }

// POST /api/queue/stats/log
// Log queue statistics (called by system)
{
  departmentId: string,
  patientsServed: number,
  avgWaitTime: number,
  avgServiceTime: number
}

// GET /api/queue/analytics/[hospitalId]
// Get queue analytics (admin only)
```

### 5.4 Zero-Net QR APIs

```typescript
// ============================================
// ZERO-NET QR APIs
// ============================================

// POST /api/qr/generate
// Generate new Zero-Net QR code
// Returns: { qrDataUrl, compressedData, encodedFields[] }

// GET /api/qr/decode
// Decode QR data (for validation/testing)
{
  data: string  // The encoded string from QR
}
// Returns: { patientData, isValid, signature }

// PATCH /api/qr/update
// Update patient's QR data (called after profile changes)
// Returns: { updated: boolean, qrDataUrl }
```

---

## Part 6: AI Integration Architecture

### 6.1 Voice-to-Notes Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI CLINICAL DOCUMENTATION PIPELINE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚     â”‚   Next.js    â”‚     â”‚   Whisper    â”‚     â”‚   Llama 3    â”‚
â”‚   MediaRec   â”‚â”€â”€â”€â”€â–¶â”‚   API        â”‚â”€â”€â”€â”€â–¶â”‚   API        â”‚â”€â”€â”€â”€â–¶â”‚   (Groq)     â”‚
â”‚   API        â”‚     â”‚              â”‚     â”‚   (Groq)     â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     Audio              Chunks              Transcript          SOAP Note

OPTION A: Groq Cloud (Recommended for Hackathon)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Groq API                                                                   â”‚
â”‚  â”œâ”€â”€ whisper-large-v3: Speech-to-Text (~$0.003/min)                        â”‚
â”‚  â””â”€â”€ llama-3.1-70b-versatile: Clinical Note Generation                     â”‚
â”‚                                                                             â”‚
â”‚  Pros: Fast, cheap, no GPU needed                                          â”‚
â”‚  Cons: Internet required, data leaves your server                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OPTION B: Self-Hosted (For Production/Compliance)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Self-Hosted Stack                                                          â”‚
â”‚  â”œâ”€â”€ Whisper.cpp: Local speech-to-text (CPU or GPU)                        â”‚
â”‚  â”œâ”€â”€ Ollama + Llama 3: Local LLM for note generation                       â”‚
â”‚  â””â”€â”€ Fine-tuned on: MTSamples, MIMIC-III (anonymized)                      â”‚
â”‚                                                                             â”‚
â”‚  Pros: HIPAA compliant, no data leaves premises                            â”‚
â”‚  Cons: Requires GPU, more setup                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Clinical Note Generation Prompt

```typescript
const CLINICAL_NOTE_SYSTEM_PROMPT = `
You are a medical documentation AI assistant. Given a transcript of a 
doctor-patient conversation, generate a structured clinical note.

OUTPUT FORMAT (JSON):
{
  "soapNote": {
    "subjective": "Patient's reported symptoms, history, and complaints",
    "objective": "Observable findings, vitals, examination results",
    "assessment": "Diagnosis/differential diagnoses with ICD-10 codes",
    "plan": "Treatment plan, medications, follow-up"
  },
  "icdCodes": ["G44.2", "R51"],  // Primary and secondary diagnoses
  "cptCodes": ["99213"],         // Procedure codes if applicable
  "prescriptions": [
    {
      "medication": "Ibuprofen",
      "dosage": "400mg",
      "frequency": "TID",
      "duration": "5 days",
      "instructions": "Take with food"
    }
  ],
  "followUp": {
    "recommended": true,
    "timeframe": "1 week",
    "condition": "If headache persists"
  },
  "redFlags": []  // Any concerning symptoms that need immediate attention
}

RULES:
1. Use medical terminology but keep notes readable
2. Include all mentioned medications with exact dosages
3. Flag any drug interactions or contraindications
4. Be concise but complete
5. If information is unclear, note "Patient to clarify: [topic]"
`;
```

### 6.3 Wait Time Prediction Model

```python
# Model Architecture (scikit-learn for hackathon simplicity)

from sklearn.ensemble import GradientBoostingRegressor
from sklearn.preprocessing import StandardScaler
import joblib

class WaitTimePredictor:
    """
    Predicts wait time for a department based on:
    - Current queue length
    - Time of day
    - Day of week
    - Historical averages
    - Staff count (if available)
    """
    
    FEATURES = [
        'current_queue_length',      # Real-time
        'hour_of_day',               # 0-23
        'day_of_week',               # 0-6
        'is_weekend',                # Boolean
        'avg_service_time',          # From department config
        'historical_wait_same_hour', # Rolling average
        'staff_on_duty',             # Optional
    ]
    
    def __init__(self):
        self.model = GradientBoostingRegressor(
            n_estimators=100,
            max_depth=5,
            learning_rate=0.1
        )
        self.scaler = StandardScaler()
    
    def train(self, historical_data):
        """Train on QueueStatistics data"""
        X = historical_data[self.FEATURES]
        y = historical_data['actual_wait_time']
        
        X_scaled = self.scaler.fit_transform(X)
        self.model.fit(X_scaled, y)
        
        joblib.dump(self.model, 'models/wait_time_model.pkl')
        joblib.dump(self.scaler, 'models/wait_time_scaler.pkl')
    
    def predict(self, features):
        """Predict wait time with confidence interval"""
        X_scaled = self.scaler.transform([features])
        prediction = self.model.predict(X_scaled)[0]
        
        # Estimate confidence interval (simplified)
        # In production, use quantile regression
        return {
            'predicted_wait': round(prediction),
            'confidence_low': round(prediction * 0.7),
            'confidence_high': round(prediction * 1.4)
        }
```

---

## Part 7: Real-Time Implementation (Supabase)

### 7.1 Enable Supabase Realtime

```sql
-- Enable realtime for journey tracking tables

-- In Supabase Dashboard â†’ Database â†’ Replication
-- Or via SQL:

ALTER PUBLICATION supabase_realtime ADD TABLE patient_journey;
ALTER PUBLICATION supabase_realtime ADD TABLE journey_checkpoint;
ALTER PUBLICATION supabase_realtime ADD TABLE queue_statistics;
```

### 7.2 Frontend Realtime Hook

```typescript
// src/hooks/useJourneyRealtime.ts

import { useEffect, useState } from 'react';
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

interface JourneyUpdate {
  checkpointId: string;
  status: string;
  queuePosition?: number;
  estimatedWait?: number;
}

export function useJourneyRealtime(journeyId: string) {
  const [updates, setUpdates] = useState<JourneyUpdate[]>([]);
  const [currentCheckpoint, setCurrentCheckpoint] = useState<JourneyUpdate | null>(null);

  useEffect(() => {
    // Subscribe to checkpoint changes
    const channel = supabase
      .channel(`journey:${journeyId}`)
      .on(
        'postgres_changes',
        {
          event: '*',
          schema: 'public',
          table: 'journey_checkpoint',
          filter: `journey_id=eq.${journeyId}`
        },
        (payload) => {
          console.log('Journey update:', payload);
          
          const update: JourneyUpdate = {
            checkpointId: payload.new.id,
            status: payload.new.status,
            queuePosition: payload.new.queue_position,
            estimatedWait: payload.new.estimated_wait
          };
          
          setUpdates(prev => [...prev, update]);
          
          if (payload.new.status === 'IN_PROGRESS') {
            setCurrentCheckpoint(update);
          }
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [journeyId]);

  return { updates, currentCheckpoint };
}
```

### 7.3 Family Sharing Realtime

```typescript
// src/hooks/useFamilyJourneyWatch.ts

export function useFamilyJourneyWatch(shareCode: string) {
  const [journey, setJourney] = useState<Journey | null>(null);
  const [checkpoints, setCheckpoints] = useState<Checkpoint[]>([]);
  const [isLive, setIsLive] = useState(false);

  useEffect(() => {
    // Initial fetch
    fetch(`/api/journey/shared/${shareCode}`)
      .then(res => res.json())
      .then(data => {
        setJourney(data.journey);
        setCheckpoints(data.checkpoints);
      });

    // Subscribe to updates
    const channel = supabase
      .channel(`shared:${shareCode}`)
      .on(
        'postgres_changes',
        {
          event: '*',
          schema: 'public',
          table: 'journey_checkpoint',
          filter: `journey_id=eq.${journey?.id}`
        },
        (payload) => {
          setCheckpoints(prev => 
            prev.map(cp => 
              cp.id === payload.new.id ? { ...cp, ...payload.new } : cp
            )
          );
        }
      )
      .subscribe((status) => {
        setIsLive(status === 'SUBSCRIBED');
      });

    return () => {
      supabase.removeChannel(channel);
    };
  }, [shareCode, journey?.id]);

  return { journey, checkpoints, isLive };
}
```

---

## Part 8: Zero-Net QR Implementation

### 8.1 QR Data Encoding

```typescript
// src/lib/zero-net-qr.ts

import { encode as msgpackEncode, decode as msgpackDecode } from '@msgpack/msgpack';
import { gzip, ungzip } from 'pako';
import { createHmac } from 'crypto';

interface EmergencyProfile {
  v: number;           // Version
  n: string;           // Name
  d: string;           // DOB (YYYY-MM-DD)
  b: string;           // Blood group
  a: string[];         // Allergies
  m: string[];         // Medications
  c: string[];         // Conditions
  e: {                 // Emergency contact
    n: string;
    r: string;
    p: string;
  };
  w: string;           // Wallet address
  t: number;           // Timestamp
  s?: string;          // Signature
}

const MAX_QR_BYTES = 2953;  // QR Code version 40, binary mode
const MAX_ITEMS = 5;        // Max items per array field
const MAX_NAME_LENGTH = 30;
const SECRET_KEY = process.env.QR_SIGNING_KEY || 'your-secret-key';

export function encodeEmergencyProfile(patientData: PatientProfile): string {
  // Build compact profile
  const profile: EmergencyProfile = {
    v: 1,
    n: (patientData.fullName || '').substring(0, MAX_NAME_LENGTH),
    d: patientData.dateOfBirth?.toISOString().split('T')[0] || '',
    b: patientData.bloodGroup || 'Unknown',
    a: (patientData.allergies?.split(',') || []).slice(0, MAX_ITEMS).map(s => s.trim()),
    m: (patientData.currentMedications?.split(',') || []).slice(0, MAX_ITEMS).map(s => s.trim()),
    c: (patientData.chronicConditions?.split(',') || []).slice(0, MAX_ITEMS).map(s => s.trim()),
    e: {
      n: (patientData.emergencyName || '').substring(0, MAX_NAME_LENGTH),
      r: (patientData.emergencyRelation || '').substring(0, 15),
      p: patientData.emergencyPhone || ''
    },
    w: patientData.walletAddress || '',
    t: Math.floor(Date.now() / 1000)
  };

  // Create signature (without 's' field)
  const dataToSign = JSON.stringify(profile);
  const signature = createHmac('sha256', SECRET_KEY)
    .update(dataToSign)
    .digest('hex')
    .substring(0, 16);  // Truncate for space
  
  profile.s = signature;

  // Encode: JSON â†’ MessagePack â†’ Gzip â†’ Base64
  const msgpacked = msgpackEncode(profile);
  const compressed = gzip(msgpacked);
  const base64 = Buffer.from(compressed).toString('base64url');

  // Verify size
  if (base64.length > MAX_QR_BYTES) {
    throw new Error(`QR data too large: ${base64.length} bytes`);
  }

  return `SS1:${base64}`;  // SS1 = Swasthya Sanchar v1 prefix
}

export function decodeEmergencyProfile(encoded: string): EmergencyProfile | null {
  try {
    // Check prefix
    if (!encoded.startsWith('SS1:')) {
      return null;
    }

    const base64 = encoded.substring(4);
    const compressed = Buffer.from(base64, 'base64url');
    const decompressed = ungzip(compressed);
    const profile = msgpackDecode(decompressed) as EmergencyProfile;

    // Verify signature
    const signature = profile.s;
    delete profile.s;
    const expectedSig = createHmac('sha256', SECRET_KEY)
      .update(JSON.stringify(profile))
      .digest('hex')
      .substring(0, 16);

    if (signature !== expectedSig) {
      console.warn('QR signature mismatch');
      // Still return data but mark as unverified
      profile.s = 'INVALID';
    } else {
      profile.s = 'VERIFIED';
    }

    return profile;
  } catch (error) {
    console.error('Failed to decode QR:', error);
    return null;
  }
}

export function generateQRCodeData(profile: EmergencyProfile): string {
  // For QR code library input
  return encodeEmergencyProfile(profile as unknown as PatientProfile);
}
```

### 8.2 Updated Emergency Page (Dual-Mode)

```typescript
// src/app/emergency/[address]/page.tsx (Updated)

"use client";

import { useEffect, useState } from "react";
import { decodeEmergencyProfile, EmergencyProfile } from "@/lib/zero-net-qr";

export default function EmergencyPage({ params }: { params: { address: string } }) {
  const [qrData, setQrData] = useState<EmergencyProfile | null>(null);
  const [serverData, setServerData] = useState<PatientEmergencyData | null>(null);
  const [dataSource, setDataSource] = useState<'qr' | 'server' | 'cache'>('qr');
  const [isOnline, setIsOnline] = useState(true);

  useEffect(() => {
    const { address } = params;

    // Check if this is a Zero-Net QR (starts with SS1:)
    if (address.startsWith('SS1:')) {
      const decoded = decodeEmergencyProfile(address);
      if (decoded) {
        setQrData(decoded);
        setDataSource('qr');
        
        // Background: try to fetch enhanced data
        if (navigator.onLine && decoded.w) {
          fetchEnhancedData(decoded.w);
        }
        return;
      }
    }

    // Legacy: wallet address URL
    fetchEmergencyData(address);
  }, [params.address]);

  async function fetchEnhancedData(walletAddress: string) {
    try {
      const response = await fetch(`/api/emergency/${walletAddress}`);
      if (response.ok) {
        const data = await response.json();
        setServerData(data);
        // Keep qrData as fallback, show enhanced data
      }
    } catch (error) {
      // Silent fail - QR data is sufficient
      console.log('Enhanced data unavailable, using QR data');
    }
  }

  // Render with appropriate data source
  const displayData = serverData || (qrData ? convertQRToDisplay(qrData) : null);

  return (
    <div className="min-h-screen bg-white dark:bg-neutral-900">
      {/* Data Source Banner */}
      <div className={`px-4 py-2 text-center text-sm ${
        dataSource === 'qr' 
          ? 'bg-green-100 text-green-800' 
          : dataSource === 'server'
          ? 'bg-blue-100 text-blue-800'
          : 'bg-yellow-100 text-yellow-800'
      }`}>
        {dataSource === 'qr' && (
          <>
            âœ… Zero-Net Mode: Data loaded from QR code (works offline)
            {qrData?.s === 'VERIFIED' && ' â€¢ Verified'}
          </>
        )}
        {dataSource === 'server' && 'ğŸŒ Enhanced data loaded from server'}
        {dataSource === 'cache' && 'ğŸ’¾ Showing cached data'}
      </div>

      {/* Rest of emergency display... */}
      {displayData && <EmergencyDisplay data={displayData} />}
    </div>
  );
}

function convertQRToDisplay(qr: EmergencyProfile): PatientEmergencyData {
  return {
    name: qr.n,
    dateOfBirth: qr.d,
    gender: '', // Not in QR
    bloodGroup: qr.b,
    allergies: qr.a.join(', '),
    chronicConditions: qr.c.join(', '),
    currentMedications: qr.m.join(', '),
    emergencyName: qr.e.n,
    emergencyRelation: qr.e.r,
    emergencyPhone: qr.e.p,
    // Fields not available in Zero-Net mode
    phone: '',
    email: '',
    address: '',
    city: '',
    state: '',
    pincode: '',
    previousSurgeries: '',
    height: '',
    weight: '',
    waistCircumference: '',
    privacySettings: {
      gender: false, phone: false, email: false, address: false,
      height: false, weight: false, waistCircumference: false, previousSurgeries: false
    }
  };
}
```

---

## Part 9: Frontend Components

### 9.1 Patient Journey Tracker Component

```typescript
// src/components/journey/JourneyTracker.tsx

"use client";

import { useJourneyRealtime } from "@/hooks/useJourneyRealtime";
import { motion, AnimatePresence } from "framer-motion";

interface JourneyTrackerProps {
  journeyId: string;
  checkpoints: Checkpoint[];
}

export function JourneyTracker({ journeyId, checkpoints }: JourneyTrackerProps) {
  const { currentCheckpoint, updates } = useJourneyRealtime(journeyId);

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'COMPLETED': return 'bg-green-500';
      case 'IN_PROGRESS': return 'bg-blue-500 animate-pulse';
      case 'IN_QUEUE': return 'bg-yellow-500';
      default: return 'bg-gray-300';
    }
  };

  const getProgress = () => {
    const completed = checkpoints.filter(c => c.status === 'COMPLETED').length;
    return (completed / checkpoints.length) * 100;
  };

  return (
    <div className="bg-white dark:bg-neutral-800 rounded-xl shadow-lg p-6">
      {/* Header */}
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-xl font-bold">Your Care Journey</h2>
        <div className="flex items-center gap-2">
          <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
          <span className="text-sm text-gray-500">Live</span>
        </div>
      </div>

      {/* Progress Bar */}
      <div className="relative h-2 bg-gray-200 rounded-full mb-8">
        <motion.div
          className="absolute h-full bg-gradient-to-r from-blue-500 to-green-500 rounded-full"
          initial={{ width: 0 }}
          animate={{ width: `${getProgress()}%` }}
          transition={{ duration: 0.5 }}
        />
      </div>

      {/* Checkpoints */}
      <div className="space-y-4">
        {checkpoints.map((checkpoint, index) => (
          <motion.div
            key={checkpoint.id}
            className={`flex items-center gap-4 p-4 rounded-lg border-2 transition-all ${
              checkpoint.status === 'IN_PROGRESS'
                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'
                : checkpoint.status === 'COMPLETED'
                ? 'border-green-500 bg-green-50 dark:bg-green-900/20'
                : 'border-gray-200'
            }`}
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ delay: index * 0.1 }}
          >
            {/* Status Indicator */}
            <div className={`w-10 h-10 rounded-full flex items-center justify-center ${getStatusColor(checkpoint.status)}`}>
              {checkpoint.status === 'COMPLETED' ? (
                <CheckIcon className="w-6 h-6 text-white" />
              ) : checkpoint.status === 'IN_PROGRESS' ? (
                <span className="text-white font-bold">{checkpoint.queuePosition || 'ğŸ¥'}</span>
              ) : (
                <span className="text-white">{index + 1}</span>
              )}
            </div>

            {/* Checkpoint Info */}
            <div className="flex-1">
              <h3 className="font-semibold">{checkpoint.name}</h3>
              <p className="text-sm text-gray-500">{checkpoint.department.name}</p>
            </div>

            {/* Time/Status */}
            <div className="text-right">
              {checkpoint.status === 'IN_PROGRESS' && (
                <div className="text-blue-600 font-semibold">
                  In Progress
                </div>
              )}
              {checkpoint.status === 'IN_QUEUE' && checkpoint.estimatedWait && (
                <div className="text-yellow-600">
                  ~{checkpoint.estimatedWait} min wait
                  {checkpoint.queuePosition && (
                    <div className="text-sm">Position #{checkpoint.queuePosition}</div>
                  )}
                </div>
              )}
              {checkpoint.status === 'COMPLETED' && checkpoint.completedAt && (
                <div className="text-green-600 text-sm">
                  âœ“ {formatTime(checkpoint.completedAt)}
                </div>
              )}
            </div>
          </motion.div>
        ))}
      </div>

      {/* Current Status Card */}
      {currentCheckpoint && (
        <motion.div
          className="mt-6 p-4 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl text-white"
          initial={{ scale: 0.95 }}
          animate={{ scale: 1 }}
        >
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm opacity-80">Currently at</p>
              <h3 className="text-xl font-bold">{currentCheckpoint.name}</h3>
            </div>
            {currentCheckpoint.estimatedWait && (
              <div className="text-right">
                <p className="text-3xl font-bold">{currentCheckpoint.estimatedWait}</p>
                <p className="text-sm opacity-80">min estimated</p>
              </div>
            )}
          </div>
        </motion.div>
      )}

      {/* Share Button */}
      <button className="mt-6 w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-blue-500 hover:text-blue-500 transition">
        ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Share with Family
      </button>
    </div>
  );
}
```

### 9.2 Voice Recorder Component

```typescript
// src/components/voice/VoiceRecorder.tsx

"use client";

import { useState, useRef, useEffect } from "react";
import { Mic, Square, Loader2 } from "lucide-react";

interface VoiceRecorderProps {
  patientId: string;
  onNoteGenerated: (noteId: string) => void;
}

export function VoiceRecorder({ patientId, onNoteGenerated }: VoiceRecorderProps) {
  const [isRecording, setIsRecording] = useState(false);
  const [isProcessing, setIsProcessing] = useState(false);
  const [duration, setDuration] = useState(0);
  const [transcript, setTranscript] = useState("");
  const [sessionId, setSessionId] = useState<string | null>(null);
  
  const mediaRecorderRef = useRef<MediaRecorder | null>(null);
  const chunksRef = useRef<Blob[]>([]);
  const timerRef = useRef<NodeJS.Timeout | null>(null);

  const startRecording = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const mediaRecorder = new MediaRecorder(stream, {
        mimeType: 'audio/webm;codecs=opus'
      });

      // Start session
      const response = await fetch('/api/voice/session/start', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ patientId })
      });
      const { sessionId: sid } = await response.json();
      setSessionId(sid);

      mediaRecorderRef.current = mediaRecorder;
      chunksRef.current = [];

      mediaRecorder.ondataavailable = async (event) => {
        if (event.data.size > 0) {
          chunksRef.current.push(event.data);
          
          // Send chunk to server
          const base64 = await blobToBase64(event.data);
          await fetch(`/api/voice/session/${sid}/chunk`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              audioData: base64,
              sequence: chunksRef.current.length,
              duration: 5000 // 5 second chunks
            })
          });
        }
      };

      mediaRecorder.start(5000); // Capture every 5 seconds
      setIsRecording(true);

      // Start timer
      timerRef.current = setInterval(() => {
        setDuration(prev => prev + 1);
      }, 1000);

    } catch (error) {
      console.error('Failed to start recording:', error);
      alert('Microphone access required');
    }
  };

  const stopRecording = async () => {
    if (!mediaRecorderRef.current || !sessionId) return;

    mediaRecorderRef.current.stop();
    mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop());
    
    if (timerRef.current) {
      clearInterval(timerRef.current);
    }

    setIsRecording(false);
    setIsProcessing(true);

    // Complete session and process
    try {
      const response = await fetch(`/api/voice/session/${sessionId}/complete`, {
        method: 'POST'
      });
      const { clinicalNoteId } = await response.json();

      // Poll for completion
      let attempts = 0;
      const maxAttempts = 30;
      
      while (attempts < maxAttempts) {
        const statusRes = await fetch(`/api/voice/session/${sessionId}/status`);
        const status = await statusRes.json();
        
        if (status.status === 'COMPLETED') {
          onNoteGenerated(status.clinicalNoteId);
          break;
        } else if (status.status === 'FAILED') {
          throw new Error('Processing failed');
        }
        
        await new Promise(resolve => setTimeout(resolve, 1000));
        attempts++;
      }
    } catch (error) {
      console.error('Processing failed:', error);
      alert('Failed to process recording');
    } finally {
      setIsProcessing(false);
      setDuration(0);
    }
  };

  const formatDuration = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  return (
    <div className="bg-white dark:bg-neutral-800 rounded-xl shadow-lg p-6">
      <h3 className="text-lg font-semibold mb-4">Voice Documentation</h3>

      <div className="flex flex-col items-center gap-4">
        {/* Recording Button */}
        <button
          onClick={isRecording ? stopRecording : startRecording}
          disabled={isProcessing}
          className={`w-24 h-24 rounded-full flex items-center justify-center transition-all ${
            isRecording
              ? 'bg-red-500 hover:bg-red-600 animate-pulse'
              : isProcessing
              ? 'bg-gray-400 cursor-not-allowed'
              : 'bg-blue-500 hover:bg-blue-600'
          }`}
        >
          {isProcessing ? (
            <Loader2 className="w-10 h-10 text-white animate-spin" />
          ) : isRecording ? (
            <Square className="w-10 h-10 text-white" />
          ) : (
            <Mic className="w-10 h-10 text-white" />
          )}
        </button>

        {/* Status */}
        <div className="text-center">
          {isRecording && (
            <>
              <div className="text-2xl font-mono text-red-500">
                {formatDuration(duration)}
              </div>
              <p className="text-sm text-gray-500">Recording... Tap to stop</p>
            </>
          )}
          {isProcessing && (
            <p className="text-sm text-blue-500">Processing with AI...</p>
          )}
          {!isRecording && !isProcessing && (
            <p className="text-sm text-gray-500">Tap to start recording consultation</p>
          )}
        </div>
      </div>

      {/* Live Transcript Preview */}
      {transcript && (
        <div className="mt-4 p-3 bg-gray-50 dark:bg-neutral-700 rounded-lg">
          <p className="text-sm text-gray-600 dark:text-gray-300">{transcript}</p>
        </div>
      )}
    </div>
  );
}

async function blobToBase64(blob: Blob): Promise<string> {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onloadend = () => resolve(reader.result as string);
    reader.onerror = reject;
    reader.readAsDataURL(blob);
  });
}
```

### 9.3 Clinical Note Editor Component

```typescript
// src/components/voice/ClinicalNoteEditor.tsx

"use client";

import { useState } from "react";
import { Save, Check, RefreshCw, Send } from "lucide-react";

interface SOAPNote {
  subjective: string;
  objective: string;
  assessment: string;
  plan: string;
}

interface ClinicalNoteProps {
  noteId: string;
  soapNote: SOAPNote;
  icdCodes: string[];
  prescriptions: Prescription[];
  onSubmit: () => void;
}

export function ClinicalNoteEditor({
  noteId,
  soapNote: initialSoap,
  icdCodes: initialCodes,
  prescriptions: initialRx,
  onSubmit
}: ClinicalNoteProps) {
  const [soapNote, setSoapNote] = useState(initialSoap);
  const [icdCodes, setIcdCodes] = useState(initialCodes);
  const [prescriptions, setPrescriptions] = useState(initialRx);
  const [isEditing, setIsEditing] = useState<keyof SOAPNote | null>(null);
  const [isSaving, setIsSaving] = useState(false);

  const sections: { key: keyof SOAPNote; label: string; color: string }[] = [
    { key: 'subjective', label: 'Subjective', color: 'blue' },
    { key: 'objective', label: 'Objective', color: 'green' },
    { key: 'assessment', label: 'Assessment', color: 'yellow' },
    { key: 'plan', label: 'Plan', color: 'purple' }
  ];

  const handleSave = async () => {
    setIsSaving(true);
    try {
      await fetch(`/api/voice/note/${noteId}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ soapNote, icdCodes, prescriptions })
      });
    } finally {
      setIsSaving(false);
      setIsEditing(null);
    }
  };

  const handleSubmitToBlockchain = async () => {
    setIsSaving(true);
    try {
      await fetch(`/api/voice/note/${noteId}/submit`, { method: 'POST' });
      onSubmit();
    } finally {
      setIsSaving(false);
    }
  };

  return (
    <div className="bg-white dark:bg-neutral-800 rounded-xl shadow-lg overflow-hidden">
      {/* Header */}
      <div className="bg-gradient-to-r from-blue-600 to-purple-600 p-4 text-white">
        <div className="flex items-center justify-between">
          <div>
            <h2 className="text-xl font-bold">AI-Generated Clinical Note</h2>
            <p className="text-sm opacity-80">Review and edit before submitting</p>
          </div>
          <div className="flex gap-2">
            <button
              onClick={handleSave}
              disabled={isSaving}
              className="px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 transition flex items-center gap-2"
            >
              <Save className="w-4 h-4" />
              Save Draft
            </button>
          </div>
        </div>
      </div>

      {/* SOAP Note Sections */}
      <div className="p-6 space-y-4">
        {sections.map(({ key, label, color }) => (
          <div key={key} className={`border-l-4 border-${color}-500 pl-4`}>
            <div className="flex items-center justify-between mb-2">
              <h3 className="font-semibold text-gray-700 dark:text-gray-300">{label}</h3>
              <button
                onClick={() => setIsEditing(isEditing === key ? null : key)}
                className="text-sm text-blue-500 hover:text-blue-600"
              >
                {isEditing === key ? 'Done' : 'Edit'}
              </button>
            </div>
            {isEditing === key ? (
              <textarea
                value={soapNote[key]}
                onChange={(e) => setSoapNote({ ...soapNote, [key]: e.target.value })}
                className="w-full p-3 border rounded-lg dark:bg-neutral-700 dark:border-neutral-600 min-h-[100px]"
                autoFocus
              />
            ) : (
              <p className="text-gray-600 dark:text-gray-400 whitespace-pre-wrap">
                {soapNote[key]}
              </p>
            )}
          </div>
        ))}
      </div>

      {/* ICD Codes */}
      <div className="px-6 pb-4">
        <h3 className="font-semibold text-gray-700 dark:text-gray-300 mb-2">
          Suggested ICD-10 Codes
        </h3>
        <div className="flex flex-wrap gap-2">
          {icdCodes.map((code, i) => (
            <span
              key={i}
              className="px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 rounded-full text-sm"
            >
              {code}
            </span>
          ))}
        </div>
      </div>

      {/* Prescriptions */}
      <div className="px-6 pb-4">
        <h3 className="font-semibold text-gray-700 dark:text-gray-300 mb-2">
          Prescriptions
        </h3>
        <div className="space-y-2">
          {prescriptions.map((rx, i) => (
            <div
              key={i}
              className="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg"
            >
              <div>
                <span className="font-medium">{rx.medication}</span>
                <span className="text-sm text-gray-500 ml-2">
                  {rx.dosage} {rx.frequency} Ã— {rx.duration}
                </span>
              </div>
              <Check className="w-5 h-5 text-green-600" />
            </div>
          ))}
        </div>
      </div>

      {/* Submit to Blockchain */}
      <div className="p-6 bg-gray-50 dark:bg-neutral-700">
        <button
          onClick={handleSubmitToBlockchain}
          disabled={isSaving}
          className="w-full py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-semibold hover:opacity-90 transition flex items-center justify-center gap-2"
        >
          <Send className="w-5 h-5" />
          Sign & Submit to Blockchain
        </button>
        <p className="text-xs text-center text-gray-500 mt-2">
          This will create an immutable record on the Polygon blockchain
        </p>
      </div>
    </div>
  );
}
```

---

## Part 10: Implementation Roadmap

### Phase 1: Foundation (Days 1-2)
```
Priority: HIGH | Complexity: MEDIUM

â–¡ Database Schema Migration
  â”œâ”€ Add journey tracking models
  â”œâ”€ Add voice documentation models
  â”œâ”€ Add queue statistics models
  â”œâ”€ Add Zero-Net QR model
  â””â”€ Run migration, test locally

â–¡ Supabase Realtime Setup
  â”œâ”€ Enable replication for journey tables
  â”œâ”€ Create Supabase client wrapper
  â””â”€ Test subscription in browser

â–¡ Environment Configuration
  â”œâ”€ Add GROQ_API_KEY for Whisper + Llama
  â”œâ”€ Add QR_SIGNING_KEY for Zero-Net
  â””â”€ Verify Polygon testnet connection
```

### Phase 2: Zero-Net QR (Days 2-3)
```
Priority: HIGH (differentiator) | Complexity: LOW

â–¡ Zero-Net Encoding Library
  â”œâ”€ Install msgpack, pako
  â”œâ”€ Implement encodeEmergencyProfile()
  â”œâ”€ Implement decodeEmergencyProfile()
  â””â”€ Write unit tests

â–¡ QR Generation Update
  â”œâ”€ Update patient QR generation
  â”œâ”€ Embed SS1: prefix + data
  â””â”€ Test with real QR scanner

â–¡ Emergency Page Update
  â”œâ”€ Detect SS1: prefix
  â”œâ”€ Decode and display locally
  â”œâ”€ Background fetch for enhanced data
  â””â”€ Offline mode indicator
```

### Phase 3: Journey Tracking (Days 3-5)
```
Priority: HIGH | Complexity: HIGH

â–¡ Backend APIs
  â”œâ”€ POST /api/journey/create
  â”œâ”€ PATCH /api/journey/checkpoint
  â”œâ”€ POST /api/journey/share
  â””â”€ GET /api/journey/shared/[code]

â–¡ Realtime Integration
  â”œâ”€ useJourneyRealtime hook
  â”œâ”€ Checkpoint update subscriptions
  â””â”€ Family sharing subscriptions

â–¡ Frontend Components
  â”œâ”€ JourneyTracker component
  â”œâ”€ FamilyShareView page
  â”œâ”€ Hospital staff checkpoint updater
  â””â”€ Mobile-responsive design

â–¡ Hospital Admin
  â”œâ”€ Department setup page
  â”œâ”€ Staff assignment
  â””â”€ Journey queue view
```

### Phase 4: AI Voice Documentation (Days 5-7)
```
Priority: MEDIUM | Complexity: HIGH

â–¡ Voice Recording
  â”œâ”€ VoiceRecorder component
  â”œâ”€ MediaRecorder API setup
  â”œâ”€ Chunk streaming to server
  â””â”€ Audio format handling

â–¡ AI Processing Pipeline
  â”œâ”€ Whisper transcription API
  â”œâ”€ Llama 3 SOAP note generation
  â”œâ”€ ICD-10 code extraction
  â””â”€ Prescription parsing

â–¡ Clinical Note UI
  â”œâ”€ ClinicalNoteEditor component
  â”œâ”€ Section-by-section editing
  â”œâ”€ Prescription management
  â””â”€ Blockchain submission

â–¡ Integration
  â”œâ”€ Link notes to journey checkpoints
  â”œâ”€ Pre-fill from blockchain records
  â””â”€ Doctor verification flow
```

### Phase 5: WhatsApp Integration (Days 5-6)
```
Priority: HIGH (India-specific) | Complexity: MEDIUM

â–¡ WhatsApp Business Setup
  â”œâ”€ Create Meta Business account
  â”œâ”€ Setup WhatsApp Business API (via Twilio/Gupshup)
  â”œâ”€ Configure webhook URL
  â””â”€ Get verified for templates

â–¡ Bot Implementation
  â”œâ”€ POST /api/whatsapp/webhook
  â”œâ”€ Message processor (text + voice)
  â”œâ”€ Template messages for journey updates
  â””â”€ Voice message transcription

â–¡ Features
  â”œâ”€ Send QR code as image message
  â”œâ”€ Journey status queries ("status", "à¤¸à¥à¤¥à¤¿à¤¤à¤¿")
  â”œâ”€ Family notifications (auto-sent)
  â”œâ”€ Voice command processing (Hindi/English)
  â””â”€ Voice response generation

â–¡ Testing
  â”œâ”€ Test with WhatsApp sandbox
  â”œâ”€ Verify multi-language support
  â””â”€ Test voice message flow
```

### Phase 6: Accessibility & Voice UI (Days 6-7)
```
Priority: HIGH (inclusive design) | Complexity: MEDIUM

â–¡ Text-to-Speech
  â”œâ”€ Browser Speech Synthesis API
  â”œâ”€ Indian language voice selection (hi-IN, mr-IN, ta-IN)
  â”œâ”€ Auto-speak on page load (opt-in)
  â””â”€ Speak button on all screens

â–¡ Voice Commands
  â”œâ”€ Speech Recognition API integration
  â”œâ”€ Hindi/English command processing
  â”œâ”€ Intent detection via AI
  â””â”€ Voice feedback loop

â–¡ Simple Mode
  â”œâ”€ Toggle for reduced complexity
  â”œâ”€ Large touch targets (60px min)
  â”œâ”€ Icon-based navigation
  â””â”€ Fewer options, clearer flow

â–¡ Accessibility
  â”œâ”€ ARIA labels on all elements
  â”œâ”€ Screen reader testing
  â”œâ”€ High contrast mode
  â”œâ”€ Font scaling support
  â””â”€ Keyboard navigation

â–¡ SMS Fallback
  â”œâ”€ Twilio SMS integration
  â”œâ”€ Short message templates (160 char)
  â”œâ”€ Fallback for no-internet scenarios
  â””â”€ Feature phone support
```

### Phase 7: Wait Time Prediction (Days 7-8)
```
Priority: MEDIUM | Complexity: MEDIUM

â–¡ Data Collection
  â”œâ”€ Log queue statistics hourly
  â”œâ”€ Capture service times
  â””â”€ Store in QueueStatistics table

â–¡ ML Model
  â”œâ”€ Simple GradientBoosting model
  â”œâ”€ Train on synthetic/hospital data
  â”œâ”€ Export for edge inference
  â””â”€ API endpoint for predictions

â–¡ Integration
  â”œâ”€ Show predictions in journey tracker
  â”œâ”€ Update estimates in real-time
  â””â”€ Display confidence intervals
```

### Phase 8: Polish & Demo (Days 8-10)
```
Priority: HIGH | Complexity: LOW

â–¡ Demo Flow Preparation
  â”œâ”€ Seed realistic hospital data
  â”œâ”€ Create demo patient journeys
  â”œâ”€ Pre-record voice notes
  â””â”€ Generate sample QR codes

â–¡ UI Polish
  â”œâ”€ Loading states
  â”œâ”€ Error handling
  â”œâ”€ Animations (Framer Motion)
  â””â”€ Mobile responsiveness

â–¡ Testing
  â”œâ”€ End-to-end journey flow
  â”œâ”€ Offline QR scanning
  â”œâ”€ Voice recording on mobile
  â””â”€ Realtime updates

â–¡ Documentation
  â”œâ”€ Update README
  â”œâ”€ API documentation
  â”œâ”€ Demo script
  â””â”€ Architecture diagram
```

---

## Part 11: Dependencies to Add

```bash
# Zero-Net QR (compact encoding)
npm install @msgpack/msgpack pako

# Realtime (Supabase client)
npm install @supabase/supabase-js

# Animation
npm install framer-motion

# WhatsApp Integration (choose one)
npm install twilio          # Option A: Twilio API
# OR use Gupshup/360dialog REST API directly

# SMS Fallback
npm install twilio          # Same as WhatsApp if using Twilio

# Voice/Speech (browser APIs - no install needed)
# - SpeechSynthesis API (TTS)
# - SpeechRecognition API (STT)
# - MediaRecorder API (audio recording)

# Accessibility
npm install @radix-ui/react-accessible-icon
npm install @radix-ui/react-visually-hidden

# ML (optional, for server-side predictions)
# Could use Python microservice or Vercel Edge function
```

---

## Part 12: Environment Variables

```env
# Add to .env.local

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# EXISTING (Already configured)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DATABASE_URL=
DIRECT_URL=
NEXTAUTH_SECRET=
NEXTAUTH_URL=
PRIVATE_KEY=                       # Backend wallet for blockchain
NEXT_PUBLIC_CONTRACT_ADDRESS=
NEXT_PUBLIC_RPC_URL=
NEXT_PUBLIC_PINATA_JWT=
NEXT_PUBLIC_PINATA_GATEWAY=
WALLET_ENCRYPTION_KEY=

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SUPABASE (for Realtime)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
NEXT_PUBLIC_SUPABASE_URL=          # https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=     # Public anon key
SUPABASE_SERVICE_ROLE_KEY=         # Server-side only

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AI SERVICES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
GROQ_API_KEY=                      # For Whisper + Llama 3 (free tier: 14,400 req/day)
                                   # Get from: https://console.groq.com/keys

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# WHATSAPP INTEGRATION (Choose one provider)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Option A: Twilio
TWILIO_ACCOUNT_SID=                # From Twilio Console
TWILIO_AUTH_TOKEN=                 # From Twilio Console
TWILIO_WHATSAPP_NUMBER=            # whatsapp:+14155238886 (sandbox)
TWILIO_PHONE_NUMBER=               # For SMS fallback

# Option B: Gupshup (Indian provider, often cheaper)
GUPSHUP_API_KEY=
GUPSHUP_APP_NAME=

# Webhook verification
WHATSAPP_VERIFY_TOKEN=             # Your custom token for webhook verification

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ZERO-NET QR
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
QR_SIGNING_KEY=                    # Secret for QR signature (use: openssl rand -hex 32)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# OPTIONAL
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
NEXT_PUBLIC_WEBSOCKET_URL=         # Custom WebSocket server (if not using Supabase)
SENTRY_DSN=                        # Error tracking (production)
```

---

## Part 12.5: WhatsApp Provider Comparison (India)

| Provider | Cost | Free Tier | Best For |
|----------|------|-----------|----------|
| **Twilio** | $0.005/msg | 500 msgs/month sandbox | Quick setup, global |
| **Gupshup** | â‚¹0.25/msg | 1000 msgs/month | Indian pricing, local support |
| **360dialog** | â‚¬0.005/msg | Limited | European compliance |
| **Meta Direct** | Template-based | 1000 free/month | Production scale |

**Recommendation for Hackathon**: Use Twilio Sandbox (free, no approval needed)
**Recommendation for Production**: Gupshup (Indian pricing, INR billing)

---

## Part 13: Quick Wins for Demo Day

### ğŸ¯ Demo Script (10-minute presentation)

```
DEMO FLOW FOR JUDGES:

1ï¸âƒ£ HOOK (30 sec)
   "What if healthcare worked like Uber - you could track your care journey,
    and it worked even in villages with no internet?"

2ï¸âƒ£ ZERO-NET QR (2 min) - THE SHOWSTOPPER
   â”œâ”€ Show QR code on screen
   â”œâ”€ Turn phone to AIRPLANE MODE
   â”œâ”€ Scan QR â†’ Instant medical data appears
   â”œâ”€ "This saves lives in rural emergencies"
   â””â”€ Show Hindi voice reading the data aloud

3ï¸âƒ£ WHATSAPP BOT (2 min) - INDIA RELEVANCE
   â”œâ”€ Send "status" to WhatsApp number
   â”œâ”€ Get journey update with buttons
   â”œâ”€ Send voice message in Hindi: "à¤®à¥‡à¤°à¥€ à¤¬à¤¾à¤°à¥€ à¤•à¤¬ à¤†à¤à¤—à¥€?"
   â”œâ”€ Receive voice response: "à¤†à¤ªà¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ 3 à¤®à¤°à¥€à¤œà¤¼ à¤¹à¥ˆà¤‚"
   â””â”€ "500 million Indians already use WhatsApp"

4ï¸âƒ£ FAMILY TRACKING (2 min) - EMOTIONAL HOOK
   â”œâ”€ Patient phone shows journey tracker
   â”œâ”€ Share link to "Mom's phone"
   â”œâ”€ Hospital staff updates checkpoint
   â”œâ”€ BOTH phones update in real-time
   â””â”€ "Families can track from anywhere"

5ï¸âƒ£ VOICE ACCESSIBILITY (1 min) - INCLUSIVE
   â”œâ”€ Enable "Simple Mode" (large icons, fewer options)
   â”œâ”€ Tap any element â†’ Voice reads in Hindi
   â”œâ”€ Speak command: "à¤®à¥‡à¤°à¥€ à¤¦à¤µà¤¾à¤‡à¤¯à¤¾à¤ à¤¬à¤¤à¤¾à¤“"
   â”œâ”€ App responds with medication list
   â””â”€ "Works for illiterate and elderly users"

6ï¸âƒ£ DOCTOR VOICE NOTES (2 min) - TIME SAVER
   â”œâ”€ Doctor starts voice recording
   â”œâ”€ Speaks naturally for 30 seconds
   â”œâ”€ AI generates SOAP note in 10 seconds
   â”œâ”€ Shows ICD codes, prescriptions
   â””â”€ "17 minutes of typing â†’ 3 minutes"

7ï¸âƒ£ BLOCKCHAIN PROOF (30 sec)
   â”œâ”€ Show transaction on Polygon explorer
   â””â”€ "Patient owns their data, works across hospitals"
```

### ğŸ† Individual Demo Setups

**1. Zero-Net QR Demo** (5 mins setup)
```
Setup:
- Generate QR code for test patient
- Ensure QR has SS1: prefix with embedded data
- Test on multiple phones (Android + iPhone)

Demo:
âœ“ Show QR code
âœ“ Turn on airplane mode
âœ“ Scan â†’ Data displays INSTANTLY
âœ“ Enable voice â†’ Hindi readout of blood type, allergies
âœ“ "In a road accident in Rajasthan, this could save your life"
```

**2. WhatsApp Bot Demo** (15 mins setup)
```
Setup:
- Configure Twilio Sandbox (free)
- Join sandbox: Send "join <sandbox-word>" to Twilio number
- Test all commands

Demo Commands:
"hi" â†’ Welcome message with menu
"status" â†’ Journey update
"qr" â†’ Receive QR code as image
ğŸ¤ Voice msg â†’ AI understands, responds in same language
```

**3. Family Tracking Demo** (10 mins setup)
```
Setup:
- Create journey with 5 checkpoints (Registration â†’ Vitals â†’ X-Ray â†’ Consultation â†’ Pharmacy)
- Generate share link
- Open on two devices

Demo:
âœ“ Device 1: Patient view (full journey tracker)
âœ“ Device 2: Family view (simplified tracking)
âœ“ Update checkpoint from admin panel
âœ“ Watch BOTH update in real-time
âœ“ Show WhatsApp notification received
```

**4. Voice Accessibility Demo** (10 mins setup)
```
Setup:
- Enable Simple Mode toggle
- Set language to Hindi
- Test voice commands

Demo:
âœ“ Tap "Enable Voice" â†’ Entire screen speaks
âœ“ Navigate with only voice commands
âœ“ "à¤®à¥‡à¤°à¤¾ à¤–à¥‚à¤¨ à¤•à¤¾ à¤ªà¥à¤°à¤•à¤¾à¤° à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?" â†’ "à¤†à¤ªà¤•à¤¾ à¤¬à¥à¤²à¤¡ à¤—à¥à¤°à¥à¤ª B+ à¤¹à¥ˆ"
âœ“ Show elderly-friendly large icons
âœ“ "My grandmother in the village can use this"
```

**5. Doctor Voice-to-Note Demo** (15 mins setup)
```
Setup:
- Pre-record a 2-minute consultation audio
- Ensure Groq API key is configured
- Test the full pipeline

Demo:
âœ“ Play pre-recorded consultation (or speak live)
âœ“ Click "Process" â†’ Show processing animation
âœ“ SOAP note appears in ~10 seconds
âœ“ Show auto-detected ICD-10 codes
âœ“ Show auto-generated prescriptions
âœ“ "Submit to Blockchain" â†’ Transaction hash
```

### ğŸ“± Phone Demo Checklist

```
BEFORE DEMO:
â–¡ Battery > 80% on all demo phones
â–¡ WhatsApp sandbox configured
â–¡ Test QR scanning works
â–¡ Test voice recognition works
â–¡ Airplane mode toggle accessible
â–¡ Mobile data ON as backup
â–¡ Clear notification badges
â–¡ Close unnecessary apps
â–¡ Test Hindi TTS voice works
â–¡ Hospital seed data loaded

DEMO DEVICES:
â–¡ Phone 1: Patient journey view
â–¡ Phone 2: Family tracking view  
â–¡ Phone 3: WhatsApp demo
â–¡ Laptop: Doctor portal + admin panel
```

### ğŸ‡®ğŸ‡³ India-Specific Talking Points

```
FOR JUDGES - Key Statistics:

ğŸ“Š "70% of India lives in rural areas with limited internet"
   â†’ Our Zero-Net QR works 100% offline

ğŸ“Š "500 million WhatsApp users in India"
   â†’ No new app download needed

ğŸ“Š "25% of Indians are illiterate"
   â†’ Our voice-first UI works without reading

ğŸ“Š "Doctors spend 17 minutes per patient on documentation"
   â†’ Our AI reduces this to 3 minutes

ğŸ“Š "Indian families stay involved in healthcare decisions"
   â†’ Family tracking respects this culture

ğŸ“Š "AIIMS OPD wait times average 4+ hours"
   â†’ Our ML predicts wait times accurately
```

---

## Part 14: Seed Data for Demo

### Sample Hospital Data (AIIMS-style)

```typescript
// prisma/seed.ts

const DEMO_HOSPITALS = [
  {
    name: "AIIMS Delhi",
    code: "AIIMS-DEL",
    address: "Sri Aurobindo Marg, Ansari Nagar",
    city: "New Delhi",
    state: "Delhi",
    pincode: "110029",
    departments: [
      { name: "Registration", code: "REG", avgServiceTime: 5, maxCapacity: 100 },
      { name: "Vitals & Triage", code: "VIT", avgServiceTime: 8, maxCapacity: 50 },
      { name: "General OPD", code: "OPD", avgServiceTime: 15, maxCapacity: 200 },
      { name: "Radiology (X-Ray)", code: "RAD", avgServiceTime: 20, maxCapacity: 30 },
      { name: "Pathology (Lab)", code: "LAB", avgServiceTime: 10, maxCapacity: 50 },
      { name: "Pharmacy", code: "PHR", avgServiceTime: 10, maxCapacity: 80 },
      { name: "Emergency", code: "ER", avgServiceTime: 30, maxCapacity: 40 },
      { name: "Cardiology", code: "CAR", avgServiceTime: 20, maxCapacity: 25 },
      { name: "Orthopedics", code: "ORT", avgServiceTime: 20, maxCapacity: 25 },
      { name: "Pediatrics", code: "PED", avgServiceTime: 15, maxCapacity: 30 }
    ]
  },
  {
    name: "Safdarjung Hospital",
    code: "SJH-DEL",
    address: "Ring Road, Safdarjung",
    city: "New Delhi",
    state: "Delhi",
    pincode: "110029",
    departments: [
      { name: "Registration", code: "REG", avgServiceTime: 10, maxCapacity: 150 },
      { name: "General OPD", code: "OPD", avgServiceTime: 12, maxCapacity: 300 },
      { name: "Emergency", code: "ER", avgServiceTime: 25, maxCapacity: 60 }
    ]
  },
  {
    name: "PHC Badarpur",  // Primary Health Center (Rural simulation)
    code: "PHC-BAD",
    address: "Badarpur Border",
    city: "New Delhi",
    state: "Delhi",
    pincode: "110044",
    departments: [
      { name: "Registration", code: "REG", avgServiceTime: 3, maxCapacity: 30 },
      { name: "Doctor Consultation", code: "DOC", avgServiceTime: 10, maxCapacity: 40 },
      { name: "Dispensary", code: "DIS", avgServiceTime: 5, maxCapacity: 30 }
    ]
  }
];

const DEMO_PATIENTS = [
  {
    name: "à¤°à¤¾à¤¹à¥à¤² à¤¶à¤°à¥à¤®à¤¾",
    email: "rahul.demo@test.com",
    dateOfBirth: new Date("1985-03-15"),
    bloodGroup: "B+",
    phone: "+91-9876543210",
    allergies: "Penicillin, Sulfa drugs",
    chronicConditions: "Type 2 Diabetes, Hypertension",
    currentMedications: "Metformin 500mg, Amlodipine 5mg",
    emergencyContact: {
      name: "à¤ªà¥à¤°à¤¿à¤¯à¤¾ à¤¶à¤°à¥à¤®à¤¾",
      relation: "Spouse",
      phone: "+91-9876543211"
    }
  },
  {
    name: "Lakshmi Devi",
    email: "lakshmi.demo@test.com",
    dateOfBirth: new Date("1955-08-20"),
    bloodGroup: "O+",
    phone: "+91-8765432109",
    allergies: "None",
    chronicConditions: "Arthritis",
    currentMedications: "Ibuprofen 400mg PRN",
    emergencyContact: {
      name: "Ramesh Kumar",
      relation: "Son",
      phone: "+91-8765432108"
    }
  }
];

const DEMO_DOCTORS = [
  {
    name: "Dr. Amit Gupta",
    email: "dr.gupta@aiims.demo",
    specialization: "General Medicine",
    hospital: "AIIMS Delhi",
    medicalLicense: "MCI-12345"
  },
  {
    name: "Dr. Priya Singh",
    email: "dr.singh@aiims.demo",
    specialization: "Cardiology",
    hospital: "AIIMS Delhi",
    medicalLicense: "MCI-23456"
  }
];
```

---

## Next Steps - Let's Build!

Based on our discussion, here's the **recommended build order**:

```
WEEK 1 (Core Features):
â”œâ”€ Day 1-2: Database migration + Supabase Realtime setup
â”œâ”€ Day 2-3: Zero-Net QR Protocol (quick win, impressive demo)
â”œâ”€ Day 3-5: Journey Tracking with realtime updates
â””â”€ Day 5-6: WhatsApp Bot integration

WEEK 2 (Polish + Accessibility):
â”œâ”€ Day 6-7: Voice UI + Accessibility features
â”œâ”€ Day 7-8: AI Voice Documentation
â”œâ”€ Day 8-9: Wait Time ML (if time permits)
â””â”€ Day 9-10: Demo prep, seed data, testing
```

**Ready to start?** Just say:
- "Let's start with Zero-Net QR" â†’ I'll implement the offline QR protocol
- "Let's start with database" â†’ I'll create the Prisma schema migration
- "Let's start with WhatsApp" â†’ I'll set up the WhatsApp webhook
- "Show me the architecture first" â†’ I'll create a visual diagram

---

*This plan is designed for Hackverse 4.0. Total estimated effort: 10 days for solo developer, 5-6 days for team of 2-3.*
